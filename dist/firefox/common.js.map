{"version":3,"file":"common.js","mappings":"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","sources":["webpack://assistente-de-regulacao-medica/./KeepAliveManager.js","webpack://assistente-de-regulacao-medica/./SectionManager.js","webpack://assistente-de-regulacao-medica/./TimelineManager.js","webpack://assistente-de-regulacao-medica/./api.js","webpack://assistente-de-regulacao-medica/./browser-polyfill.js","webpack://assistente-de-regulacao-medica/./field-config.js","webpack://assistente-de-regulacao-medica/./filter-config.js","webpack://assistente-de-regulacao-medica/./renderers.js","webpack://assistente-de-regulacao-medica/./store.js","webpack://assistente-de-regulacao-medica/./ui/patient-card.js","webpack://assistente-de-regulacao-medica/./ui/search.js","webpack://assistente-de-regulacao-medica/./utils.js"],"sourcesContent":["/**\r\n * @file Gerenciador de Keep-Alive para manter a sessão ativa\r\n */\r\nimport * as API from './api.js';\r\n\r\nexport class KeepAliveManager {\r\n  constructor() {\r\n    this.intervalId = null;\r\n    this.isActive = false;\r\n    this.intervalMinutes = 10; // Padrão: 10 minutos\r\n    \r\n    this.init();\r\n  }\r\n\r\n  async init() {\r\n    // Carrega as configurações salvas\r\n    await this.loadSettings();\r\n    \r\n    // Escuta mudanças nas configurações\r\n    if (typeof browser !== 'undefined') {\r\n      browser.storage.onChanged.addListener((changes, areaName) => {\r\n        if (areaName === 'sync' && changes.keepSessionAliveInterval) {\r\n          this.updateInterval(changes.keepSessionAliveInterval.newValue);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  async loadSettings() {\r\n    try {\r\n      const api = typeof browser !== 'undefined' ? browser : chrome;\r\n      const result = await api.storage.sync.get({\r\n        keepSessionAliveInterval: 10\r\n      });\r\n      \r\n      this.updateInterval(result.keepSessionAliveInterval);\r\n    } catch (error) {\r\n      console.error('Erro ao carregar configurações do keep-alive:', error);\r\n    }\r\n  }\r\n\r\n  updateInterval(minutes) {\r\n    const newMinutes = parseInt(minutes, 10) || 0;\r\n    \r\n    this.intervalMinutes = newMinutes;\r\n    \r\n    // Para o timer atual\r\n    this.stop();\r\n    \r\n    // Inicia novo timer se o valor for maior que 0\r\n    if (this.intervalMinutes > 0) {\r\n      this.start();\r\n    }\r\n  }\r\n\r\n  start() {\r\n    if (this.intervalMinutes <= 0) {\r\n      console.log('Keep-alive desativado (intervalo = 0)');\r\n      return;\r\n    }\r\n\r\n    if (this.isActive) {\r\n      console.log('Keep-alive já está ativo');\r\n      return;\r\n    }\r\n\r\n    const intervalMs = this.intervalMinutes * 60 * 1000; // Converte minutos para milissegundos\r\n    \r\n    this.intervalId = setInterval(async () => {\r\n      try {\r\n        const success = await API.keepSessionAlive();\r\n        if (success) {\r\n          console.log(`Keep-alive executado com sucesso (${new Date().toLocaleTimeString()})`);\r\n        } else {\r\n          console.warn(`Keep-alive falhou (${new Date().toLocaleTimeString()})`);\r\n        }\r\n      } catch (error) {\r\n        console.error('Erro no keep-alive:', error);\r\n      }\r\n    }, intervalMs);\r\n\r\n    this.isActive = true;\r\n    console.log(`Keep-alive iniciado: ${this.intervalMinutes} minutos (${intervalMs}ms)`);\r\n  }\r\n\r\n  stop() {\r\n    if (this.intervalId) {\r\n      clearInterval(this.intervalId);\r\n      this.intervalId = null;\r\n    }\r\n    \r\n    this.isActive = false;\r\n    console.log('Keep-alive parado');\r\n  }\r\n\r\n  getStatus() {\r\n    return {\r\n      isActive: this.isActive,\r\n      intervalMinutes: this.intervalMinutes,\r\n      nextExecution: this.isActive ? new Date(Date.now() + (this.intervalMinutes * 60 * 1000)) : null\r\n    };\r\n  }\r\n}","/**\r\n * @file Módulo SectionManager, responsável por gerir uma secção inteira da sidebar.\r\n */\r\n\r\nimport { filterConfig } from './filter-config.js';\r\nimport * as Utils from './utils.js';\r\nimport * as API from './api.js';\r\nimport { store } from './store.js';\r\n\r\n/**\r\n * Gera o HTML para o indicador de ordenação (seta para cima/baixo).\r\n * @param {string} key - A chave da coluna atual.\r\n * @param {object} state - O objeto de estado de ordenação da secção.\r\n * @returns {string} O caractere da seta ou uma string vazia.\r\n */\r\nexport function getSortIndicator(key, state) {\r\n  if (state.key !== key) return '';\r\n  return state.order === 'asc' ? '▲' : '▼';\r\n}\r\n\r\nexport class SectionManager {\r\n  /**\r\n   * @param {string} sectionKey - A chave da secção (ex: \"consultations\").\r\n   * @param {object} config - Configurações específicas da secção.\r\n   * @param {Function} config.fetchFunction - A função da API para buscar dados.\r\n   * @param {Function} config.renderFunction - A função para renderizar os dados.\r\n   * @param {object} config.initialSortState - O estado inicial de ordenação.\r\n   * @param {object} globalSettings - Configurações globais da aplicação.\r\n   */\r\n  constructor(sectionKey, config, globalSettings) {\r\n    this.sectionKey = sectionKey;\r\n    this.prefix = this.getPrefix(sectionKey);\r\n    this.config = config;\r\n    this.globalSettings = globalSettings;\r\n\r\n    this.allData = [];\r\n    this.currentPatient = null;\r\n    this.isLoading = false;\r\n    this.sortState = { ...config.initialSortState };\r\n    this.fetchType = 'all';\r\n\r\n    this.elements = {};\r\n\r\n    this.init();\r\n  }\r\n\r\n  getPrefix(sectionKey) {\r\n    const map = {\r\n      consultations: 'consultation',\r\n      exams: 'exam',\r\n      appointments: 'appointment',\r\n      regulations: 'regulation',\r\n      documents: 'document',\r\n    };\r\n    return map[sectionKey] || sectionKey;\r\n  }\r\n\r\n  init() {\r\n    this.cacheDomElements();\r\n    this.renderFilterControls();\r\n    this.addEventListeners();\r\n    store.subscribe(() => this.onStateChange());\r\n  }\r\n\r\n  onStateChange() {\r\n    const patientState = store.getPatient();\r\n    const newPatient = patientState ? patientState.ficha : null;\r\n\r\n    if (this.currentPatient?.isenPK?.idp !== newPatient?.isenPK?.idp) {\r\n      this.setPatient(newPatient);\r\n    }\r\n\r\n    this.populateSavedFilterDropdown();\r\n  }\r\n\r\n  cacheDomElements() {\r\n    const { sectionKey, prefix } = this;\r\n    this.elements = {\r\n      section: document.getElementById(`${sectionKey}-section`),\r\n      wrapper: document.getElementById(`${sectionKey}-wrapper`),\r\n      content: document.getElementById(`${sectionKey}-content`),\r\n      fetchBtn: document.getElementById(`fetch-${sectionKey}-btn`),\r\n      toggleBtn: document.getElementById(`toggle-${sectionKey}-list-btn`),\r\n      toggleMoreBtn: document.getElementById(\r\n        `toggle-more-${prefix}-filters-btn`\r\n      ),\r\n      clearBtn: document.getElementById(`clear-${prefix}-filters-btn`),\r\n      mainFilters: document.getElementById(`${prefix}-main-filters`),\r\n      moreFilters: document.getElementById(`${prefix}-more-filters`),\r\n      automationFeedback: document.getElementById(\r\n        `${sectionKey}-automation-feedback`\r\n      ),\r\n    };\r\n  }\r\n\r\n  addEventListeners() {\r\n    this.elements.fetchBtn?.addEventListener('click', () => this.fetchData());\r\n    this.elements.toggleBtn?.addEventListener('click', () =>\r\n      this.toggleSection()\r\n    );\r\n    this.elements.toggleMoreBtn?.addEventListener('click', () =>\r\n      this.toggleMoreFilters()\r\n    );\r\n    this.elements.clearBtn?.addEventListener('click', () =>\r\n      this.clearFilters()\r\n    );\r\n\r\n    this.elements.section?.addEventListener(\r\n      'input',\r\n      Utils.debounce((e) => {\r\n        if (e.target.matches(\"input[type='text'], input[type='date']\"))\r\n          this.applyFiltersAndRender();\r\n      }, 300)\r\n    );\r\n\r\n    this.elements.section?.addEventListener('change', (e) => {\r\n      if (e.target.matches(\"select, input[type='checkbox']\")) {\r\n        if (e.target.closest('.filter-select-group')) {\r\n          this.handleFetchTypeChange(e.target);\r\n        } else {\r\n          this.applyFiltersAndRender();\r\n        }\r\n      }\r\n      if (e.target.id === `${this.prefix}-saved-filters-select`)\r\n        this.loadFilterSet();\r\n    });\r\n\r\n    this.elements.section?.addEventListener('click', (e) => {\r\n      const target = e.target;\r\n      const sortHeader = target.closest('.sort-header');\r\n      if (sortHeader) this.handleSort(sortHeader.dataset.sortKey);\r\n\r\n      if (target.closest(`#${this.prefix}-save-filter-btn`))\r\n        this.saveFilterSet();\r\n      if (target.closest(`#${this.prefix}-delete-filter-btn`))\r\n        this.deleteFilterSet();\r\n      if (target.closest('.clear-automation-btn')) {\r\n        this.clearAutomationFeedbackAndFilters(true);\r\n      }\r\n    });\r\n  }\r\n\r\n  setPatient(patient) {\r\n    this.currentPatient = patient;\r\n    this.allData = [];\r\n    this.clearFilters(false); // Reseta os filtros para o padrão ao trocar de paciente.\r\n    this.clearAutomationFeedbackAndFilters(false);\r\n    this.applyFiltersAndRender();\r\n\r\n    if (this.elements.section) {\r\n      this.elements.section.style.display = patient ? 'block' : 'none';\r\n    }\r\n\r\n    if (\r\n      patient &&\r\n      this.globalSettings.userPreferences[\r\n        `autoLoad${\r\n          this.sectionKey.charAt(0).toUpperCase() + this.sectionKey.slice(1)\r\n        }`\r\n      ]\r\n    ) {\r\n      this.fetchData();\r\n    }\r\n  }\r\n\r\n  async fetchData() {\r\n    if (!this.currentPatient) {\r\n      if (this.elements.section.style.display !== 'none')\r\n        Utils.showMessage('Nenhum paciente selecionado.');\r\n      return;\r\n    }\r\n    if (this.isLoading) return;\r\n\r\n    this.isLoading = true;\r\n    this.elements.content.innerHTML =\r\n      '<p class=\"text-slate-500\">Carregando...</p>';\r\n\r\n    try {\r\n      const fetchTypeElement = this.elements.mainFilters?.querySelector(\r\n        `#${this.prefix}-fetch-type-buttons`\r\n      );\r\n      if (fetchTypeElement) {\r\n        this.fetchType = fetchTypeElement.value;\r\n      }\r\n\r\n      const dataInicialValue = this.elements.dateInitial\r\n        ? this.elements.dateInitial.value\r\n        : null;\r\n      const dataFinalValue = this.elements.dateFinal\r\n        ? this.elements.dateFinal.value\r\n        : null;\r\n\r\n      const params = {\r\n        isenPK: `${this.currentPatient.isenPK.idp}-${this.currentPatient.isenPK.ids}`,\r\n        isenFullPKCrypto: this.currentPatient.isenFullPKCrypto,\r\n        dataInicial: dataInicialValue\r\n          ? new Date(dataInicialValue).toLocaleDateString('pt-BR')\r\n          : '01/01/1900',\r\n        dataFinal: dataFinalValue\r\n          ? new Date(dataFinalValue).toLocaleDateString('pt-BR')\r\n          : new Date().toLocaleDateString('pt-BR'),\r\n        type: this.fetchType,\r\n      };\r\n\r\n      if (this.sectionKey === 'exams') {\r\n        params.comResultado =\r\n          this.fetchType === 'withResult' || this.fetchType === 'all';\r\n        params.semResultado =\r\n          this.fetchType === 'withoutResult' || this.fetchType === 'all';\r\n      }\r\n\r\n      const result = await this.config.fetchFunction(params);\r\n      this.allData = Array.isArray(result) ? result : result.jsonData || [];\r\n    } catch (error) {\r\n      console.error(`Erro ao buscar dados para ${this.sectionKey}:`, error);\r\n      const sectionNameMap = {\r\n        consultations: 'consultas',\r\n        exams: 'exames',\r\n        appointments: 'agendamentos',\r\n        regulations: 'regulações',\r\n        documents: 'documentos',\r\n      };\r\n      const friendlyName = sectionNameMap[this.sectionKey] || this.sectionKey;\r\n      Utils.showMessage(\r\n        `Erro ao buscar ${friendlyName}. Verifique a conexão e a URL base.`\r\n      );\r\n      this.allData = [];\r\n    } finally {\r\n      this.isLoading = false;\r\n      this.applyFiltersAndRender();\r\n    }\r\n  }\r\n\r\n  applyFiltersAndRender() {\r\n    let filteredData = [...this.allData];\r\n    if (this.config.filterLogic) {\r\n      filteredData = this.config.filterLogic(\r\n        filteredData,\r\n        this.getFilterValues(),\r\n        this.fetchType\r\n      );\r\n    }\r\n    const sortedData = this.sortData(filteredData);\r\n    this.config.renderFunction(sortedData, this.sortState, this.globalSettings);\r\n    this.updateActiveFiltersIndicator();\r\n  }\r\n\r\n  sortData(data) {\r\n    const { key, order } = this.sortState;\r\n    return [...data].sort((a, b) => {\r\n      let valA, valB;\r\n      if (key === 'date' || key === 'sortableDate') {\r\n        valA = a.sortableDate || Utils.parseDate(a.date);\r\n        valB = b.sortableDate || Utils.parseDate(b.date);\r\n      } else {\r\n        valA = (a[key] || '').toString().toLowerCase();\r\n        valB = (b[key] || '').toString().toLowerCase();\r\n      }\r\n      if (valA < valB) return order === 'asc' ? -1 : 1;\r\n      if (valA > valB) return order === 'asc' ? 1 : -1;\r\n      return 0;\r\n    });\r\n  }\r\n\r\n  getFilterValues() {\r\n    const values = {};\r\n    const filters = filterConfig[this.sectionKey] || [];\r\n    filters.forEach((filter) => {\r\n      if (filter.type === 'component') return;\r\n\r\n      const el = document.getElementById(filter.id);\r\n      if (el) {\r\n        values[filter.id] = el.type === 'checkbox' ? el.checked : el.value;\r\n      }\r\n    });\r\n    return values;\r\n  }\r\n\r\n  toggleSection() {\r\n    this.elements.wrapper?.classList.toggle('show');\r\n    this.elements.toggleBtn.textContent =\r\n      this.elements.wrapper.classList.contains('show')\r\n        ? 'Recolher'\r\n        : 'Expandir';\r\n  }\r\n\r\n  toggleMoreFilters() {\r\n    const shouldShow = !this.elements.moreFilters.classList.contains('show');\r\n    this.elements.moreFilters.classList.toggle('show', shouldShow);\r\n    this.elements.toggleMoreBtn.querySelector('.button-text').textContent =\r\n      shouldShow ? 'Menos filtros' : 'Mais filtros';\r\n    this.updateActiveFiltersIndicator();\r\n  }\r\n\r\n  clearFilters(shouldRender = true) {\r\n    const sectionLayout =\r\n      this.globalSettings.filterLayout[this.sectionKey] || [];\r\n    const layoutMap = new Map(sectionLayout.map((f) => [f.id, f]));\r\n\r\n    // --- INÍCIO DA CORREÇÃO ---\r\n    // Reseta o período de busca para o padrão global da seção\r\n    const dateRangeDefaults =\r\n      this.globalSettings.userPreferences.dateRangeDefaults;\r\n    const defaultRanges = {\r\n      consultations: { start: -6, end: 0 },\r\n      exams: { start: -6, end: 0 },\r\n      appointments: { start: -1, end: 3 },\r\n      regulations: { start: -12, end: 0 },\r\n      documents: { start: -24, end: 0 },\r\n    };\r\n    const range =\r\n      dateRangeDefaults[this.sectionKey] || defaultRanges[this.sectionKey];\r\n    if (this.elements.dateInitial)\r\n      this.elements.dateInitial.valueAsDate = Utils.calculateRelativeDate(\r\n        range.start\r\n      );\r\n    if (this.elements.dateFinal)\r\n      this.elements.dateFinal.valueAsDate = Utils.calculateRelativeDate(\r\n        range.end\r\n      );\r\n    // --- FIM DA CORREÇÃO ---\r\n\r\n    (filterConfig[this.sectionKey] || []).forEach((filter) => {\r\n      if (filter.type === 'component') return;\r\n\r\n      const el = document.getElementById(filter.id);\r\n      if (el) {\r\n        const savedFilterSettings = layoutMap.get(filter.id);\r\n        let defaultValue;\r\n\r\n        if (\r\n          savedFilterSettings &&\r\n          savedFilterSettings.defaultValue !== undefined\r\n        ) {\r\n          defaultValue = savedFilterSettings.defaultValue;\r\n        } else {\r\n          defaultValue =\r\n            filter.defaultChecked ??\r\n            (filter.options ? filter.options[0].value : '');\r\n        }\r\n\r\n        if (el.type === 'checkbox') {\r\n          el.checked = defaultValue;\r\n        } else {\r\n          el.value = defaultValue;\r\n        }\r\n\r\n        if (el.classList.contains('filter-select-group')) {\r\n          this.handleFetchTypeChange(el);\r\n        }\r\n      }\r\n    });\r\n    if (shouldRender) {\r\n      this.applyFiltersAndRender();\r\n    }\r\n  }\r\n\r\n  handleSort(sortKey) {\r\n    if (this.sortState.key === sortKey) {\r\n      this.sortState.order = this.sortState.order === 'asc' ? 'desc' : 'asc';\r\n    } else {\r\n      this.sortState.key = sortKey;\r\n      this.sortState.order = 'desc';\r\n    }\r\n    this.applyFiltersAndRender();\r\n  }\r\n\r\n  handleFetchTypeChange(element) {\r\n    this.fetchType = element.value || element.dataset.fetchType;\r\n    this.fetchData();\r\n  }\r\n\r\n  updateActiveFiltersIndicator() {\r\n    const indicator = this.elements.toggleMoreBtn?.querySelector(\r\n      'span:not(.button-text)'\r\n    );\r\n    if (!indicator || !this.elements.moreFilters) return;\r\n    const isShown = this.elements.moreFilters.classList.contains('show');\r\n    let activeCount = 0;\r\n    const filterElements =\r\n      this.elements.moreFilters.querySelectorAll('input, select');\r\n    filterElements.forEach((el) => {\r\n      if (\r\n        (el.type === 'select-one' || el.type === 'select') &&\r\n        el.value !== 'todos' &&\r\n        el.value !== 'todas' &&\r\n        el.value !== '' &&\r\n        el.value !== 'all'\r\n      )\r\n        activeCount++;\r\n      else if (el.type === 'text' && el.value.trim() !== '') activeCount++;\r\n      else if (el.type === 'checkbox' && el.checked) activeCount++;\r\n    });\r\n    if (activeCount > 0 && !isShown) {\r\n      indicator.textContent = activeCount;\r\n      indicator.classList.remove('hidden');\r\n    } else {\r\n      indicator.classList.add('hidden');\r\n    }\r\n  }\r\n\r\n  saveFilterSet() {\r\n    const name = window.prompt('Digite um nome para o conjunto de filtros:');\r\n    if (!name || name.trim() === '') {\r\n      Utils.showMessage('Nome inválido. O filtro não foi salvo.');\r\n      return;\r\n    }\r\n\r\n    const savedSets = store.getSavedFilterSets();\r\n    if (!savedSets[this.sectionKey]) {\r\n      savedSets[this.sectionKey] = [];\r\n    }\r\n    const existingIndex = savedSets[this.sectionKey].findIndex(\r\n      (set) => set.name === name\r\n    );\r\n    const filterValues = this.getFilterValues();\r\n    const newSet = { name, values: filterValues };\r\n    if (existingIndex > -1) {\r\n      savedSets[this.sectionKey][existingIndex] = newSet;\r\n    } else {\r\n      savedSets[this.sectionKey].push(newSet);\r\n    }\r\n    browser.storage.local.set({ savedFilterSets: savedSets });\r\n    store.setSavedFilterSets(savedSets);\r\n    Utils.showMessage(`Filtro \"${name}\" salvo com sucesso.`, 'success');\r\n  }\r\n\r\n  loadFilterSet() {\r\n    const select = document.getElementById(\r\n      `${this.prefix}-saved-filters-select`\r\n    );\r\n    const name = select.value;\r\n    if (!name) return;\r\n    const set = (store.getSavedFilterSets()[this.sectionKey] || []).find(\r\n      (s) => s.name === name\r\n    );\r\n    if (!set) return;\r\n    Object.entries(set.values).forEach(([id, value]) => {\r\n      const el = document.getElementById(id);\r\n      if (el) {\r\n        if (el.type === 'checkbox') el.checked = value;\r\n        else el.value = value;\r\n\r\n        if (el.classList.contains('filter-select-group')) {\r\n          this.handleFetchTypeChange(el);\r\n        }\r\n      }\r\n    });\r\n    this.applyFiltersAndRender();\r\n  }\r\n\r\n  deleteFilterSet() {\r\n    const select = document.getElementById(\r\n      `${this.prefix}-saved-filters-select`\r\n    );\r\n    const name = select.value;\r\n    if (!name) {\r\n      Utils.showMessage('Selecione um filtro para apagar.');\r\n      return;\r\n    }\r\n\r\n    const confirmation = window.confirm(\r\n      `Tem certeza que deseja apagar o filtro \"${name}\"?`\r\n    );\r\n    if (!confirmation) return;\r\n\r\n    const savedSets = store.getSavedFilterSets();\r\n    savedSets[this.sectionKey] = (savedSets[this.sectionKey] || []).filter(\r\n      (set) => set.name !== name\r\n    );\r\n    browser.storage.local.set({ savedFilterSets: savedSets });\r\n    store.setSavedFilterSets(savedSets);\r\n    Utils.showMessage(`Filtro \"${name}\" apagado.`, 'success');\r\n  }\r\n\r\n  populateSavedFilterDropdown() {\r\n    const select = document.getElementById(\r\n      `${this.prefix}-saved-filters-select`\r\n    );\r\n    if (!select) return;\r\n    const currentSelection = select.value;\r\n    select.innerHTML = '<option value=\"\">Carregar filtro...</option>';\r\n    const sets = store.getSavedFilterSets()[this.sectionKey] || [];\r\n    sets.forEach((set) => {\r\n      const option = document.createElement('option');\r\n      option.value = set.name;\r\n      option.textContent = set.name;\r\n      select.appendChild(option);\r\n    });\r\n    select.value = currentSelection;\r\n  }\r\n\r\n  renderFilterControls() {\r\n    try {\r\n      const sectionFilters = filterConfig[this.sectionKey] || [];\r\n      const sectionLayout =\r\n        this.globalSettings.filterLayout[this.sectionKey] || [];\r\n      const layoutMap = new Map(sectionLayout.map((f) => [f.id, f]));\r\n\r\n      const sortedItems = [...sectionFilters].sort((a, b) => {\r\n        const orderA = layoutMap.get(a.id)?.order ?? Infinity;\r\n        const orderB = layoutMap.get(b.id)?.order ?? Infinity;\r\n        return orderA - orderB;\r\n      });\r\n\r\n      if (this.elements.mainFilters) this.elements.mainFilters.innerHTML = '';\r\n      if (this.elements.moreFilters) this.elements.moreFilters.innerHTML = '';\r\n\r\n      sortedItems.forEach((item) => {\r\n        const location =\r\n          layoutMap.get(item.id)?.location || item.defaultLocation;\r\n        const container =\r\n          location === 'main'\r\n            ? this.elements.mainFilters\r\n            : this.elements.moreFilters;\r\n\r\n        if (container) {\r\n          let element;\r\n          if (item.type === 'component') {\r\n            element = this.createUiComponent(item.componentName);\r\n          } else {\r\n            element = this.createFilterElement(item);\r\n          }\r\n          if (element) {\r\n            container.appendChild(element);\r\n          }\r\n        }\r\n      });\r\n    } catch (e) {\r\n      console.error(`Erro ao renderizar filtros para ${this.sectionKey}:`, e);\r\n    }\r\n  }\r\n\r\n  createUiComponent(componentName) {\r\n    switch (componentName) {\r\n    case 'date-range':\r\n      return this.renderDateRangeComponent();\r\n    case 'saved-filters':\r\n      return this.renderSavedFiltersComponent();\r\n    default:\r\n      return null;\r\n    }\r\n  }\r\n\r\n  renderDateRangeComponent() {\r\n    const container = document.createElement('div');\r\n    container.className = 'grid grid-cols-2 gap-4 text-sm';\r\n    container.innerHTML = `\r\n        <div>\r\n            <label for=\"${this.prefix}-date-initial\" class=\"block font-medium\">Data Inicial</label>\r\n            <input type=\"date\" id=\"${this.prefix}-date-initial\" class=\"mt-1 w-full px-2 py-1 border border-slate-300 rounded-md\"/>\r\n        </div>\r\n        <div>\r\n            <label for=\"${this.prefix}-date-final\" class=\"block font-medium\">Data Final</label>\r\n            <input type=\"date\" id=\"${this.prefix}-date-final\" class=\"mt-1 w-full px-2 py-1 border border-slate-300 rounded-md\"/>\r\n        </div>\r\n      `;\r\n    this.elements.dateInitial = container.querySelector(\r\n      `#${this.prefix}-date-initial`\r\n    );\r\n    this.elements.dateFinal = container.querySelector(\r\n      `#${this.prefix}-date-final`\r\n    );\r\n    return container;\r\n  }\r\n\r\n  renderSavedFiltersComponent() {\r\n    const container = document.createElement('div');\r\n    container.className = 'mt-4 pt-4 border-t';\r\n    container.id = `${this.prefix}-saved-filters-container`;\r\n    container.innerHTML = `\r\n        <h3 class=\"text-sm font-semibold text-slate-600 mt-3 mb-2\">Filtros Salvos</h3>\r\n        <div class=\"flex items-center gap-2\">\r\n            <select id=\"${this.prefix}-saved-filters-select\" class=\"flex-grow w-full px-2 py-1 border border-slate-300 rounded-md bg-white text-sm\" title=\"Carregar um filtro salvo\">\r\n                <option value=\"\">Carregar filtro...</option>\r\n            </select>\r\n            <button id=\"${this.prefix}-save-filter-btn\" title=\"Salvar filtros atuais\" class=\"p-1.5 text-slate-500 hover:bg-blue-100 hover:text-blue-600 rounded\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" viewBox=\"0 0 16 16\"><path d=\"M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v4.5h2a.5.5 0 0 1 .354.854l-2.5 2.5a.5.5 0 0 1-.708 0l-2.5-2.5A.5.5 0 0 1 5.5 6.5h2V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z\"/></svg>\r\n            </button>\r\n            <button id=\"${this.prefix}-delete-filter-btn\" title=\"Apagar filtro selecionado\" class=\"p-1.5 text-slate-500 hover:bg-red-100 hover:text-red-600 rounded\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" viewBox=\"0 0 16 16\"><path d=\"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z\"/><path fill-rule=\"evenodd\" d=\"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z\"/></svg>\r\n            </button>\r\n        </div>\r\n      `;\r\n    this.elements.savedFiltersContainer = container;\r\n    this.populateSavedFilterDropdown();\r\n    return container;\r\n  }\r\n\r\n  createFilterElement(filter) {\r\n    const container = document.createElement('div');\r\n    let elementHtml = '';\r\n    if (filter.type !== 'checkbox') {\r\n      elementHtml += `<label for=\"${filter.id}\" class=\"block font-medium mb-1 text-sm\">${filter.label}</label>`;\r\n    }\r\n    switch (filter.type) {\r\n    case 'text':\r\n      elementHtml += `<input type=\"text\" id=\"${filter.id}\" placeholder=\"${\r\n        filter.placeholder || ''\r\n      }\" class=\"w-full px-2 py-1 border border-slate-300 rounded-md\">`;\r\n      break;\r\n    case 'select':\r\n    case 'selectGroup':\r\n      elementHtml += `<select id=\"${filter.id}\" class=\"w-full px-2 py-1 border border-slate-300 rounded-md bg-white\">`;\r\n\r\n      if (\r\n        filter.id === 'regulation-filter-priority' &&\r\n          this.globalSettings.regulationPriorities\r\n      ) {\r\n        elementHtml += '<option value=\"todas\">Todas</option>';\r\n        this.globalSettings.regulationPriorities.forEach((prio) => {\r\n          elementHtml += `<option value=\"${prio.coreDescricao}\">${prio.coreDescricao}</option>`;\r\n        });\r\n      } else {\r\n        (filter.options || []).forEach((opt) => {\r\n          elementHtml += `<option value=\"${opt.value}\">${opt.text}</option>`;\r\n        });\r\n      }\r\n      elementHtml += '</select>';\r\n      break;\r\n    case 'checkbox':\r\n      container.className = 'flex items-center';\r\n      elementHtml += `<input id=\"${filter.id}\" type=\"checkbox\" class=\"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500\">\r\n                          <label for=\"${filter.id}\" class=\"ml-2 block text-sm text-slate-700\">${filter.label}</label>`;\r\n      break;\r\n    }\r\n    container.innerHTML = elementHtml;\r\n    return container;\r\n  }\r\n\r\n  applyAutomationFilters(filterSettings, ruleName) {\r\n    if (!filterSettings) return;\r\n\r\n    // --- INÍCIO DA CORREÇÃO ---\r\n    // Aplica o período de busca da regra, se definido\r\n    if (filterSettings.dateRange) {\r\n      const { start, end } = filterSettings.dateRange;\r\n      if (this.elements.dateInitial && start !== null && !isNaN(start)) {\r\n        this.elements.dateInitial.valueAsDate =\r\n          Utils.calculateRelativeDate(start);\r\n      }\r\n      if (this.elements.dateFinal && end !== null && !isNaN(end)) {\r\n        this.elements.dateFinal.valueAsDate = Utils.calculateRelativeDate(end);\r\n      }\r\n    }\r\n    // --- FIM DA CORREÇÃO ---\r\n\r\n    Object.entries(filterSettings).forEach(([filterId, value]) => {\r\n      // Pula a propriedade dateRange que já foi tratada\r\n      if (filterId === 'dateRange') return;\r\n\r\n      const el = document.getElementById(filterId);\r\n      if (el) {\r\n        if (el.type === 'checkbox') {\r\n          el.checked = value;\r\n        } else {\r\n          el.value = value;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.fetchData();\r\n\r\n    if (this.elements.automationFeedback) {\r\n      this.elements.automationFeedback.innerHTML = `\r\n            <div class=\"flex justify-between items-center\">\r\n                <span>Filtro automático aplicado: <strong>${ruleName}</strong></span>\r\n                <button class=\"clear-automation-btn text-blue-800 hover:text-blue-900 font-bold\" title=\"Limpar filtro automático\">&times;</button>\r\n            </div>\r\n        `;\r\n      this.elements.automationFeedback.classList.remove('hidden');\r\n    }\r\n  }\r\n\r\n  clearAutomationFeedbackAndFilters(shouldRender = true) {\r\n    if (\r\n      this.elements.automationFeedback &&\r\n      !this.elements.automationFeedback.classList.contains('hidden')\r\n    ) {\r\n      this.elements.automationFeedback.classList.add('hidden');\r\n      this.elements.automationFeedback.innerHTML = '';\r\n      this.clearFilters(false);\r\n    }\r\n    if (shouldRender) {\r\n      this.applyFiltersAndRender();\r\n    }\r\n  }\r\n}\r\n","/**\r\n * @file Módulo TimelineManager, responsável por gerir a secção da Linha do Tempo.\r\n */\r\nimport * as API from './api.js';\r\nimport * as Utils from './utils.js';\r\nimport * as Renderers from './renderers.js';\r\nimport { store } from './store.js';\r\n\r\nexport class TimelineManager {\r\n  constructor(sectionKey, config, globalSettings) {\r\n    this.sectionKey = sectionKey;\r\n    this.config = config;\r\n    this.globalSettings = globalSettings;\r\n\r\n    this.allData = [];\r\n    this.currentPatient = null;\r\n    this.isLoading = false;\r\n\r\n    // State for automation filters\r\n    this.activeRuleFilters = null;\r\n    this.activeRuleName = null;\r\n    this.isFilteredView = false;\r\n\r\n    this.elements = {};\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    this.cacheDomElements();\r\n    this.addEventListeners();\r\n    store.subscribe(() => this.onStateChange());\r\n  }\r\n\r\n  cacheDomElements() {\r\n    this.elements = {\r\n      section: document.getElementById('timeline-section'),\r\n      wrapper: document.getElementById('timeline-wrapper'),\r\n      content: document.getElementById('timeline-content'),\r\n      fetchBtn: document.getElementById('fetch-timeline-btn'),\r\n      toggleBtn: document.getElementById('toggle-timeline-list-btn'),\r\n      automationFeedback: document.getElementById(\r\n        'timeline-automation-feedback'\r\n      ),\r\n      dateInitial: document.getElementById('timeline-date-initial'),\r\n      dateFinal: document.getElementById('timeline-date-final'),\r\n      searchKeyword: document.getElementById('timeline-search-keyword'),\r\n    };\r\n  }\r\n\r\n  addEventListeners() {\r\n    this.elements.fetchBtn?.addEventListener('click', () => this.fetchData());\r\n    this.elements.toggleBtn?.addEventListener('click', () =>\r\n      this.toggleSection()\r\n    );\r\n\r\n    this.elements.searchKeyword?.addEventListener(\r\n      'input',\r\n      Utils.debounce(() => this.render(), 300)\r\n    );\r\n    this.elements.dateInitial?.addEventListener('change', () => this.render());\r\n    this.elements.dateFinal?.addEventListener('change', () => this.render());\r\n\r\n    this.elements.section?.addEventListener('click', (event) => {\r\n      const header = event.target.closest('.timeline-header');\r\n      if (header) {\r\n        const details = header.nextElementSibling;\r\n        if (details && details.classList.contains('timeline-details-body')) {\r\n          details.classList.toggle('show');\r\n        }\r\n        return;\r\n      }\r\n\r\n      const toggleDetailsBtn = event.target.closest('.timeline-toggle-details-btn');\r\n      if (toggleDetailsBtn) {\r\n        const timelineItem = toggleDetailsBtn.closest('.timeline-item');\r\n        const details = timelineItem?.querySelector('.timeline-details-body');\r\n        if (details) {\r\n          details.classList.toggle('show');\r\n        }\r\n        return;\r\n      }\r\n\r\n      const toggleFilterBtn = event.target.closest(\r\n        '#timeline-toggle-filter-btn'\r\n      );\r\n      if (toggleFilterBtn) {\r\n        this.toggleFilteredView();\r\n      }\r\n    });\r\n  }\r\n\r\n  onStateChange() {\r\n    const patientState = store.getPatient();\r\n    const newPatient = patientState ? patientState.ficha : null;\r\n\r\n    if (this.currentPatient?.isenPK?.idp !== newPatient?.isenPK?.idp) {\r\n      this.setPatient(newPatient);\r\n    }\r\n  }\r\n\r\n  setPatient(patient) {\r\n    this.currentPatient = patient;\r\n    this.allData = [];\r\n    this.clearAutomation();\r\n    this.elements.content.innerHTML = '';\r\n    if (this.elements.searchKeyword) {\r\n      this.elements.searchKeyword.value = '';\r\n    }\r\n    this.applyDefaultDateRange();\r\n\r\n    if (this.elements.section) {\r\n      this.elements.section.style.display = patient ? 'block' : 'none';\r\n    }\r\n  }\r\n\r\n  applyDefaultDateRange() {\r\n    const dateRangeDefaults =\r\n      this.globalSettings.userPreferences.dateRangeDefaults;\r\n    const range = dateRangeDefaults.timeline || { start: -12, end: 0 };\r\n\r\n    if (this.elements.dateInitial)\r\n      this.elements.dateInitial.valueAsDate = Utils.calculateRelativeDate(\r\n        range.start\r\n      );\r\n    if (this.elements.dateFinal)\r\n      this.elements.dateFinal.valueAsDate = Utils.calculateRelativeDate(\r\n        range.end\r\n      );\r\n  }\r\n\r\n  async fetchData() {\r\n    if (!this.currentPatient || this.isLoading) {\r\n      return;\r\n    }\r\n\r\n    this.isLoading = true;\r\n    Renderers.renderTimeline([], 'loading');\r\n\r\n    try {\r\n      const params = {\r\n        isenPK: `${this.currentPatient.isenPK.idp}-${this.currentPatient.isenPK.ids}`,\r\n        isenFullPKCrypto: this.currentPatient.isenFullPKCrypto,\r\n        dataInicial: '01/01/1900', // Busca sempre o histórico completo\r\n        dataFinal: new Date().toLocaleDateString('pt-BR'),\r\n      };\r\n\r\n      const apiData = await API.fetchAllTimelineData(params);\r\n      const normalizedData = Utils.normalizeTimelineData(apiData);\r\n\r\n      this.allData = normalizedData;\r\n      this.render();\r\n    } catch (error) {\r\n      console.error('Erro ao buscar dados para a Linha do Tempo:', error);\r\n      Renderers.renderTimeline([], 'error');\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  getFilterValues() {\r\n    return {\r\n      startDate: this.elements.dateInitial?.value,\r\n      endDate: this.elements.dateFinal?.value,\r\n      keyword: Utils.normalizeString(this.elements.searchKeyword?.value || ''),\r\n    };\r\n  }\r\n\r\n  render() {\r\n    if (this.allData.length === 0 && !this.isLoading) {\r\n      Renderers.renderTimeline([], 'empty');\r\n      return;\r\n    }\r\n\r\n    let dataToRender = this.allData;\r\n    const filters = this.getFilterValues();\r\n\r\n    // Client-side filtering\r\n    if (filters.startDate) {\r\n      const startDate = new Date(filters.startDate);\r\n      dataToRender = dataToRender.filter(\r\n        (event) => event.sortableDate >= startDate\r\n      );\r\n    }\r\n    if (filters.endDate) {\r\n      const endDate = new Date(filters.endDate);\r\n      endDate.setHours(23, 59, 59, 999); // Garante que o dia final seja incluído\r\n      dataToRender = dataToRender.filter(\r\n        (event) => event.sortableDate <= endDate\r\n      );\r\n    }\r\n    if (filters.keyword) {\r\n      dataToRender = dataToRender.filter((event) =>\r\n        event.searchText.includes(filters.keyword)\r\n      );\r\n    }\r\n\r\n    // Automation rule filtering\r\n    if (this.isFilteredView && this.activeRuleFilters) {\r\n      dataToRender = Utils.filterTimelineEvents(\r\n        dataToRender,\r\n        this.activeRuleFilters\r\n      );\r\n    }\r\n\r\n    Renderers.renderTimeline(dataToRender, 'success');\r\n  }\r\n\r\n  toggleSection() {\r\n    this.elements.wrapper?.classList.toggle('show');\r\n    this.elements.toggleBtn.textContent =\r\n      this.elements.wrapper.classList.contains('show')\r\n        ? 'Recolher'\r\n        : 'Expandir';\r\n  }\r\n\r\n  applyAutomationFilters(filters, ruleName) {\r\n    this.activeRuleFilters = filters;\r\n    this.activeRuleName = ruleName;\r\n    this.isFilteredView = false;\r\n\r\n    if (this.elements.automationFeedback) {\r\n      this.elements.automationFeedback.innerHTML = `\r\n            <div class=\"flex justify-between items-center text-sm\">\r\n                <span>Regra '<strong>${ruleName}</strong>' ativa.</span>\r\n                <button id=\"timeline-toggle-filter-btn\" class=\"font-semibold text-blue-600 hover:underline\">\r\n                    Ver timeline focada\r\n                </button>\r\n            </div>\r\n        `;\r\n      this.elements.automationFeedback.classList.remove('hidden');\r\n    }\r\n\r\n    if (this.allData.length > 0) {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  clearAutomation() {\r\n    this.activeRuleFilters = null;\r\n    this.activeRuleName = null;\r\n    this.isFilteredView = false;\r\n    if (this.elements.automationFeedback) {\r\n      this.elements.automationFeedback.classList.add('hidden');\r\n      this.elements.automationFeedback.innerHTML = '';\r\n    }\r\n    if (this.allData.length > 0) {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  toggleFilteredView() {\r\n    this.isFilteredView = !this.isFilteredView;\r\n    const button = document.getElementById('timeline-toggle-filter-btn');\r\n    if (button) {\r\n      button.textContent = this.isFilteredView\r\n        ? 'Ver timeline completa'\r\n        : 'Ver timeline focada';\r\n    }\r\n    this.render();\r\n  }\r\n}\r\n","import './browser-polyfill.js';\r\n\r\nconst api = typeof browser !== 'undefined' ? browser : chrome;\r\n\r\n/**\r\n * Obtém a URL base do sistema a partir das configurações salvas pelo usuário.\r\n * @returns {Promise<string>} A URL base salva.\r\n */\r\nexport async function getBaseUrl() {\r\n  let data;\r\n  try {\r\n    data = await api.storage.sync.get('baseUrl');\r\n  } catch (e) {\r\n    console.error('Erro ao obter a URL base do storage:', e);\r\n    throw e;\r\n  }\r\n\r\n  if (data && data.baseUrl) {\r\n    return data.baseUrl;\r\n  }\r\n\r\n  console.error(\"URL base não configurada. Vá em 'Opções' para configurá-la.\");\r\n  throw new Error('URL_BASE_NOT_CONFIGURED');\r\n}\r\n\r\n/**\r\n * Lida com erros de fetch de forma centralizada.\r\n * @param {Response} response - O objeto de resposta do fetch.\r\n */\r\nfunction handleFetchError(response) {\r\n  console.error(\r\n    `Erro na requisição: ${response.status} ${response.statusText}`\r\n  );\r\n  throw new Error('Falha na comunicação com o servidor.');\r\n}\r\n\r\n/**\r\n * Extrai o texto de uma string HTML.\r\n * @param {string} htmlString - A string HTML.\r\n * @returns {string} O texto extraído.\r\n */\r\nfunction getTextFromHTML(htmlString) {\r\n  if (!htmlString) return '';\r\n  const parser = new DOMParser();\r\n  const doc = parser.parseFromString(htmlString, 'text/html');\r\n  return doc.body.textContent || '';\r\n}\r\n\r\n/**\r\n * Busca as configurações de prioridade de regulação do sistema.\r\n * @returns {Promise<Array<object>>} Uma lista de objetos de prioridade.\r\n */\r\nexport async function fetchRegulationPriorities() {\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(\r\n    `${baseUrl}/sigss/configuracaoGravidade/loadConfiguracaoRegra`\r\n  );\r\n\r\n  try {\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      console.error('Não foi possível buscar as prioridades de regulação.');\r\n      return [];\r\n    }\r\n    const data = await response.json();\r\n    // Filtra apenas as ativas e ordena pela ordem de exibição definida no sistema\r\n    return data\r\n      .filter((p) => p.coreIsAtivo === 't')\r\n      .sort((a, b) => a.coreOrdemExibicao - b.coreOrdemExibicao);\r\n  } catch (error) {\r\n    console.error('Erro de rede ao buscar prioridades:', error);\r\n    return []; // Retorna lista vazia em caso de falha de rede\r\n  }\r\n}\r\n\r\n/**\r\n * Busca os detalhes completos de uma regulação específica.\r\n * @param {object} params\r\n * @param {string} params.reguIdp - O IDP da regulação.\r\n * @param {string} params.reguIds - O IDS da regulação.\r\n * @returns {Promise<object>} O objeto com os dados da regulação.\r\n */\r\nexport async function fetchRegulationDetails({ reguIdp, reguIds }) {\r\n  if (!reguIdp || !reguIds) {\r\n    throw new Error('IDs da regulação são necessários.');\r\n  }\r\n  const baseUrl = await getBaseUrl();\r\n  // Este é o endpoint que vimos no arquivo HAR.\r\n  const url = new URL(\r\n    `${baseUrl}/sigss/regulacaoControleSolicitacao/visualiza`\r\n  );\r\n  url.search = new URLSearchParams({\r\n    'reguPK.idp': reguIdp,\r\n    'reguPK.ids': reguIds,\r\n  }).toString();\r\n\r\n  const response = await fetch(url, {\r\n    method: 'GET',\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    handleFetchError(response);\r\n    return null;\r\n  }\r\n\r\n  const contentType = response.headers.get('content-type');\r\n  if (contentType && contentType.includes('application/json')) {\r\n    const data = await response.json();\r\n    // O objeto de dados está aninhado sob a chave \"regulacao\"\r\n    return data.regulacao || null;\r\n  } else {\r\n    throw new Error(\r\n      'A resposta do servidor não foi JSON. A sessão pode ter expirado.'\r\n    );\r\n  }\r\n}\r\n\r\nfunction parseConsultasHTML(htmlString) {\r\n  const parser = new DOMParser();\r\n  const doc = parser.parseFromString(htmlString, 'text/html');\r\n  const rows = Array.from(doc.querySelectorAll('tbody > tr'));\r\n  const consultations = [];\r\n  const getFormattedText = (element) => {\r\n    if (!element) return '';\r\n    const clone = element.cloneNode(true);\r\n    clone\r\n      .querySelectorAll('br')\r\n      .forEach((br) =>\r\n        br.parentNode.replaceChild(document.createTextNode('\\n'), br)\r\n      );\r\n    return clone.textContent || '';\r\n  };\r\n  const parseDateForSorting = (dateString) => {\r\n    const datePart = (\r\n      dateString.split('\\n').find((p) => p.startsWith('At')) || dateString\r\n    )\r\n      .replace('At', '')\r\n      .trim();\r\n    const match = datePart.match(\r\n      /(\\d{2})\\/(\\d{2})\\/(\\d{4})(?: (\\d{2}):(\\d{2}):(\\d{2}))?/\r\n    );\r\n    if (!match) return null;\r\n    const [, day, month, year, hour = 0, minute = 0, second = 0] = match;\r\n    return new Date(year, month - 1, day, hour, minute, second);\r\n  };\r\n  let i = 0;\r\n  while (i < rows.length) {\r\n    const mainRow = rows[i];\r\n    const mainCells = mainRow.querySelectorAll('td');\r\n    if (mainCells.length < 5 || !mainCells[0].className.includes('width10')) {\r\n      i++;\r\n      continue;\r\n    }\r\n    const dateText = mainCells[1].textContent.trim().replace(/\\s+/g, ' ');\r\n    const consultation = {\r\n      priority: mainCells[0].textContent.trim(),\r\n      date: dateText.replace('At', '\\nAt'),\r\n      sortableDate: parseDateForSorting(dateText),\r\n      unit: mainCells[2].textContent.trim(),\r\n      specialty: mainCells[3].textContent.trim(),\r\n      professional: mainCells[4].textContent\r\n        .trim()\r\n        .replace(/Insc\\.: \\d+/, '')\r\n        .trim(),\r\n      details: [],\r\n      isNoShow: mainRow.textContent.includes('FALTOU A CONSULTA'),\r\n    };\r\n    let endIndex = rows.findIndex(\r\n      (row, index) =>\r\n        index > i &&\r\n        row.querySelectorAll('td').length > 5 &&\r\n        row.querySelectorAll('td')[0].className.includes('width10')\r\n    );\r\n    if (endIndex === -1) endIndex = rows.length;\r\n    const blockRows = rows.slice(i + 1, endIndex);\r\n    const isSoapNote = blockRows.some((row) =>\r\n      row.textContent.includes('SOAP -')\r\n    );\r\n    if (isSoapNote) {\r\n      const soapSections = ['SUBJETIVO', 'OBJETIVO', 'AVALIAÇÃO', 'PLANO'];\r\n      soapSections.forEach((sectionName) => {\r\n        const headerRowIndex = blockRows.findIndex((row) =>\r\n          row.textContent.includes(`SOAP - ${sectionName}`)\r\n        );\r\n        if (headerRowIndex === -1) return;\r\n        let content = '',\r\n          ciapCid = '',\r\n          obsNota = '';\r\n        const contentEndIndex = blockRows.findIndex(\r\n          (row, index) =>\r\n            index > headerRowIndex && row.textContent.includes('SOAP -')\r\n        );\r\n        const sectionRows = blockRows.slice(\r\n          headerRowIndex + 1,\r\n          contentEndIndex !== -1 ? contentEndIndex : blockRows.length\r\n        );\r\n        sectionRows.forEach((row) => {\r\n          const diagCell = Array.from(row.querySelectorAll('td')).find(\r\n            (cell) =>\r\n              cell.textContent.includes('CID -') ||\r\n              cell.textContent.includes('CIAP -')\r\n          );\r\n          if (diagCell) {\r\n            ciapCid = diagCell.textContent.trim();\r\n            if (diagCell.nextElementSibling)\r\n              ciapCid += ` - ${diagCell.nextElementSibling.textContent.trim()}`;\r\n          }\r\n          const descDiv = row.querySelector('.divHpdnObs');\r\n          if (descDiv) content += getFormattedText(descDiv);\r\n          const obsCell = Array.from(row.querySelectorAll('td')).find((cell) =>\r\n            cell.textContent.trim().startsWith('OBS./NOTA:')\r\n          );\r\n          if (obsCell)\r\n            obsNota = obsCell.textContent.replace('OBS./NOTA:', '').trim();\r\n        });\r\n        let finalValue = '';\r\n        if (ciapCid) finalValue += ciapCid.trim();\r\n        if (obsNota)\r\n          finalValue += (finalValue ? '\\n' : '') + `Obs.: ${obsNota.trim()}`;\r\n        if (content)\r\n          finalValue +=\r\n            (finalValue ? '\\n' : '') + `Descrição: ${content.trim()}`;\r\n        if (finalValue.trim())\r\n          consultation.details.push({ label: sectionName, value: finalValue });\r\n      });\r\n    } else {\r\n      blockRows.forEach((row) => {\r\n        const cidCell = Array.from(row.querySelectorAll('td')).find((cell) =>\r\n          cell.textContent.includes('CID -')\r\n        );\r\n        if (cidCell) {\r\n          const descCell = cidCell.nextElementSibling;\r\n          if (descCell)\r\n            consultation.details.push({\r\n              label: 'Hipótese Diagnóstica',\r\n              value: `${cidCell.textContent.trim()} - ${descCell.textContent.trim()}`,\r\n            });\r\n        }\r\n        const rowText = row.textContent.trim();\r\n        if (rowText.includes('DESCRIÇÃO DA CONSULTA')) {\r\n          const nextRow = row.nextElementSibling;\r\n          const descDiv = nextRow?.querySelector('.divHpdnObs');\r\n          if (descDiv)\r\n            consultation.details.push({\r\n              label: 'Descrição da Consulta',\r\n              value: getFormattedText(descDiv).trim(),\r\n            });\r\n        }\r\n        if (rowText.includes('OBSERVAÇÃO DE ENFERMAGEM:')) {\r\n          const obsCell = row.querySelector('td[colspan]');\r\n          if (obsCell)\r\n            consultation.details.push({\r\n              label: 'Observação de Enfermagem',\r\n              value: getFormattedText(obsCell)\r\n                .replace('OBSERVAÇÃO DE ENFERMAGEM:', '')\r\n                .trim(),\r\n            });\r\n        }\r\n      });\r\n    }\r\n    consultations.push(consultation);\r\n    i = endIndex;\r\n  }\r\n  return consultations;\r\n}\r\n\r\nexport async function searchPatients(term) {\r\n  if (!term || term.length < 1) return [];\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/usuarioServico/busca`);\r\n  url.search = new URLSearchParams({ searchString: term });\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n  return Array.isArray(data)\r\n    ? data.map((p) => ({\r\n      idp: p[0],\r\n      ids: p[1],\r\n      value: p[5],\r\n      cns: p[6],\r\n      dataNascimento: p[7],\r\n      cpf: p[15],\r\n    }))\r\n    : [];\r\n}\r\n\r\nexport async function fetchVisualizaUsuario({ idp, ids }) {\r\n  if (!idp || !ids)\r\n    throw new Error(`ID inválido. idp: '${idp}', ids: '${ids}'.`);\r\n  const baseUrl = await getBaseUrl();\r\n  const url = `${baseUrl}/sigss/usuarioServico/visualiza`;\r\n  const body = `isenPK.idp=${encodeURIComponent(\r\n    idp\r\n  )}&isenPK.ids=${encodeURIComponent(ids)}`;\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n    },\r\n    body,\r\n  });\r\n  if (!response.ok) handleFetchError(response);\r\n\r\n  const contentType = response.headers.get('content-type');\r\n  if (contentType && contentType.indexOf('application/json') !== -1) {\r\n    const patientData = await response.json();\r\n    return patientData?.usuarioServico || {};\r\n  } else {\r\n    console.error(\r\n      'A resposta do servidor não foi JSON. Provável expiração de sessão.'\r\n    );\r\n    throw new Error(\r\n      'A sessão pode ter expirado. Por favor, faça login no sistema novamente.'\r\n    );\r\n  }\r\n}\r\n\r\nexport async function fetchProntuarioHash({\r\n  isenFullPKCrypto,\r\n  dataInicial,\r\n  dataFinal,\r\n}) {\r\n  const baseUrl = await getBaseUrl();\r\n  const url = `${baseUrl}/sigss/common/queryStrToParamHash`;\r\n  const rawParamString = `isenFullPKCrypto=${isenFullPKCrypto}&moip_idp=4&moip_ids=1&dataInicial=${dataInicial}&dataFinal=${dataFinal}&ppdc=t&consulta_basica=t&obs_enfermagem=t&encaminhamento=t&consulta_especializada=t&consulta_odonto=t&exame_solicitado=t&exame=t&triagem=t&procedimento=t&vacina=t&proc_odonto=t&medicamento_receitado=t&demais_orientacoes=t&medicamento_retirado=t&aih=t&acs=t&lista_espera=t&beneficio=f&internacao=t&apac=t&procedimento_coletivo=t&justificativa=&responsavelNome=&responsavelCPF=&isOdonto=t&isSoOdonto=f`;\r\n  const response = await fetch(url, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n    },\r\n    body: `paramString=${encodeURIComponent(rawParamString)}`,\r\n  });\r\n  if (!response.ok)\r\n    throw new Error('Não foi possível gerar o passe de acesso.');\r\n  const data = await response.json();\r\n  if (data?.string) return data.string;\r\n  throw new Error(data.mensagem || 'Resposta não continha o hash.');\r\n}\r\n\r\nexport async function fetchConsultasEspecializadas({\r\n  isenFullPKCrypto,\r\n  dataInicial,\r\n  dataFinal,\r\n}) {\r\n  if (!isenFullPKCrypto) throw new Error('ID criptografado necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(\r\n    `${baseUrl}/sigss/prontuarioAmbulatorial2/buscaDadosConsultaEspecializadas_HTML`\r\n  );\r\n  url.search = new URLSearchParams({\r\n    isenFullPKCrypto,\r\n    dataInicial,\r\n    dataFinal,\r\n  });\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n  return {\r\n    htmlData: data?.tabela || '',\r\n    jsonData: parseConsultasHTML(data?.tabela || ''),\r\n  };\r\n}\r\n\r\nexport async function fetchConsultasBasicas({\r\n  isenFullPKCrypto,\r\n  dataInicial,\r\n  dataFinal,\r\n}) {\r\n  if (!isenFullPKCrypto) throw new Error('ID criptografado necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(\r\n    `${baseUrl}/sigss/prontuarioAmbulatorial2/buscaDadosConsulta_HTML`\r\n  );\r\n  url.search = new URLSearchParams({\r\n    isenFullPKCrypto,\r\n    dataInicial,\r\n    dataFinal,\r\n  });\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n  return {\r\n    htmlData: data?.tabela || '',\r\n    jsonData: parseConsultasHTML(data?.tabela || ''),\r\n  };\r\n}\r\n\r\nexport async function fetchAllConsultations({\r\n  isenFullPKCrypto,\r\n  dataInicial,\r\n  dataFinal,\r\n}) {\r\n  const [basicasResult, especializadasResult] = await Promise.all([\r\n    fetchConsultasBasicas({ isenFullPKCrypto, dataInicial, dataFinal }),\r\n    fetchConsultasEspecializadas({ isenFullPKCrypto, dataInicial, dataFinal }),\r\n  ]);\r\n  const combinedJsonData = [\r\n    ...basicasResult.jsonData,\r\n    ...especializadasResult.jsonData,\r\n  ];\r\n  const combinedHtmlData = `<h3>Consultas Básicas</h3>${basicasResult.htmlData}<h3>Consultas Especializadas</h3>${especializadasResult.htmlData}`;\r\n  return { jsonData: combinedJsonData, htmlData: combinedHtmlData };\r\n}\r\n\r\nexport async function fetchExamesSolicitados({\r\n  isenPK,\r\n  dataInicial,\r\n  dataFinal,\r\n  comResultado,\r\n  semResultado,\r\n}) {\r\n  if (!isenPK) throw new Error('ID (isenPK) do paciente é necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/exameRequisitado/findAllReex`);\r\n  const params = {\r\n    'filters[0]': `dataInicial:${dataInicial}`,\r\n    'filters[1]': `dataFinal:${dataFinal}`,\r\n    'filters[2]': `isenPK:${isenPK}`,\r\n    exameSolicitadoMin: 'true',\r\n    exameSolicitadoOutro: 'true',\r\n    exameComResultado: comResultado,\r\n    exameSemResultado: semResultado,\r\n    tipoBusca: 'reex',\r\n    _search: 'false',\r\n    nd: Date.now(),\r\n    rows: '1000',\r\n    page: '1',\r\n    sidx: 'reex.reexData',\r\n    sord: 'asc',\r\n  };\r\n  url.search = new URLSearchParams(params).toString();\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n  return (data?.rows || []).map((row) => {\r\n    const cell = row.cell || [];\r\n    return {\r\n      id: row.id || '',\r\n      date: cell[2] || '',\r\n      examName: (cell[5] || '').trim(),\r\n      hasResult: (cell[6] || '') === 'SIM',\r\n      professional: cell[8] || '',\r\n      specialty: cell[9] || '',\r\n      resultIdp: cell[13] != null ? String(cell[13]) : '',\r\n      resultIds: cell[14] != null ? String(cell[14]) : '',\r\n    };\r\n  });\r\n}\r\n\r\nexport async function fetchResultadoExame({ idp, ids }) {\r\n  if (!idp || !ids)\r\n    throw new Error('IDs do resultado do exame são necessários.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/resultadoExame/visualizaImagem`);\r\n  url.search = new URLSearchParams({\r\n    'iterPK.idp': idp,\r\n    'iterPK.ids': ids,\r\n  }).toString();\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n  return data?.path || null;\r\n}\r\n\r\nexport async function fetchCadsusData({ cpf, cns }) {\r\n  if (!cpf && !cns) {\r\n    return null;\r\n  }\r\n\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(\r\n    `${baseUrl}/sigss/usuarioServicoConsultaPDQ/consultarPaciente`\r\n  );\r\n\r\n  const params = new URLSearchParams({\r\n    _search: 'false',\r\n    rows: '50',\r\n    page: '1',\r\n    sidx: 'nome',\r\n    sord: 'asc',\r\n    'pdq.cartaoNacionalSus': '',\r\n    'pdq.cpf': '',\r\n    'pdq.rg': '',\r\n    'pdq.nome': '',\r\n    'pdq.dataNascimento': '',\r\n    'pdq.sexo': '',\r\n    'pdq.nomeMae': '',\r\n  });\r\n\r\n  if (cpf) {\r\n    const formattedCpf = String(cpf)\r\n      .replace(/\\D/g, '')\r\n      .replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\r\n    params.set('pdq.cpf', formattedCpf);\r\n  } else if (cns) {\r\n    params.set('pdq.cartaoNacionalSus', cns);\r\n  }\r\n\r\n  url.search = params.toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    console.warn(`A busca no CADSUS falhou com status ${response.status}.`);\r\n    return null;\r\n  }\r\n\r\n  const data = await response.json();\r\n\r\n  if (data && data.rows && data.rows.length > 0) {\r\n    return data.rows[0].cell;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nexport async function fetchAppointmentDetails({ idp, ids }) {\r\n  if (!idp || !ids) throw new Error('ID do agendamento é necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/agendamentoConsulta/visualiza`);\r\n  url.search = new URLSearchParams({\r\n    'agcoPK.idp': idp,\r\n    'agcoPK.ids': ids,\r\n  }).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    console.error(`Falha ao buscar detalhes do agendamento ${idp}-${ids}`);\r\n    return null;\r\n  }\r\n  const data = await response.json();\r\n  return data?.agendamentoConsulta || null;\r\n}\r\n\r\n/**\r\n * NEW: Busca os detalhes de um agendamento de exame.\r\n * @param {object} params\r\n * @param {string} params.idp - O IDP do agendamento de exame.\r\n * @param {string} params.ids - O IDS do agendamento de exame.\r\n * @returns {Promise<object>} O objeto com os dados do agendamento de exame.\r\n */\r\nexport async function fetchExamAppointmentDetails({ idp, ids }) {\r\n  if (!idp || !ids) throw new Error('ID do agendamento de exame é necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/agendamentoExame/visualizar`);\r\n  url.search = new URLSearchParams({\r\n    'examPK.idp': idp,\r\n    'examPK.ids': ids,\r\n  }).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) {\r\n    handleFetchError(response);\r\n    return null;\r\n  }\r\n  const data = await response.json();\r\n  return data?.agendamentoExame || null;\r\n}\r\n\r\nexport async function fetchAppointments({ isenPK, dataInicial, dataFinal }) {\r\n  if (!isenPK) throw new Error('ID (isenPK) do paciente é necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/resumoCompromisso/lista`);\r\n  const params = {\r\n    isenPK,\r\n    dataInicial,\r\n    dataFinal,\r\n    _search: 'false',\r\n    nd: Date.now(),\r\n    rows: '1000',\r\n    page: '1',\r\n    sidx: 'data',\r\n    sord: 'desc',\r\n  };\r\n  url.search = new URLSearchParams(params).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n\r\n  const basicAppointments = (data?.rows || []).map((row) => {\r\n    const cell = row.cell || [];\r\n    let status = 'AGENDADO';\r\n    if (String(cell[10]).includes('red')) status = 'FALTOU';\r\n    else if (String(cell[7]).includes('blue')) status = 'PRESENTE';\r\n    else if (String(cell[8]).includes('red')) status = 'CANCELADO';\r\n    else if (String(cell[11]).includes('blue')) status = 'ATENDIDO';\r\n\r\n    return {\r\n      id: row.id || '',\r\n      type: cell[1] || 'N/A',\r\n      date: cell[2] || '',\r\n      time: cell[3] || '',\r\n      location: cell[4] || '',\r\n      professional: cell[5] || '',\r\n      description: (cell[6] || '').trim(),\r\n      status: status,\r\n    };\r\n  });\r\n\r\n  const enrichedAppointments = [];\r\n  const batchSize = 10;\r\n\r\n  for (let i = 0; i < basicAppointments.length; i += batchSize) {\r\n    const batch = basicAppointments.slice(i, i + batchSize);\r\n\r\n    const promises = batch.map(async (appt) => {\r\n      if (appt.type.toUpperCase().includes('EXAME')) {\r\n        return {\r\n          ...appt,\r\n          specialty: appt.description || 'Exame sem descrição',\r\n        };\r\n      }\r\n\r\n      const [idp, ids] = appt.id.split('-');\r\n      if (!idp || !ids) return appt;\r\n\r\n      try {\r\n        const details = await fetchAppointmentDetails({ idp, ids });\r\n        if (details) {\r\n          let specialtyString = 'Sem especialidade';\r\n          const apcn = details.atividadeProfissionalCnes;\r\n\r\n          if (apcn && apcn.apcnNome) {\r\n            specialtyString = apcn.apcnCod\r\n              ? `${apcn.apcnNome} (${apcn.apcnCod})`\r\n              : apcn.apcnNome;\r\n          }\r\n\r\n          return {\r\n            ...appt,\r\n            isSpecialized: details.agcoIsEspecializada === 't',\r\n            isOdonto: details.agcoIsOdonto === 't',\r\n            specialty: specialtyString,\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.warn(\r\n          `Falha ao buscar detalhes para o agendamento ${appt.id}`,\r\n          error\r\n        );\r\n      }\r\n      return appt;\r\n    });\r\n\r\n    const settledBatch = await Promise.all(promises);\r\n    enrichedAppointments.push(...settledBatch);\r\n  }\r\n\r\n  return enrichedAppointments;\r\n}\r\n\r\nasync function fetchRegulations({\r\n  isenPK,\r\n  modalidade,\r\n  dataInicial,\r\n  dataFinal,\r\n}) {\r\n  if (!isenPK) throw new Error('ID (isenPK) do paciente é necessário.');\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/regulacaoRegulador/lista`);\r\n\r\n  const params = {\r\n    'filters[0]': `isFiltrarData:${!!dataInicial}`,\r\n    'filters[1]': `dataInicial:${dataInicial || ''}`,\r\n    'filters[2]': `dataFinal:${dataFinal || ''}`,\r\n    'filters[3]': `modalidade:${modalidade}`,\r\n    'filters[4]': 'solicitante:undefined',\r\n    'filters[5]': `usuarioServico:${isenPK}`,\r\n    'filters[6]': 'autorizado:true',\r\n    'filters[7]': 'pendente:true',\r\n    'filters[8]': 'devolvido:true',\r\n    'filters[9]': 'negado:true',\r\n    'filters[10]': 'emAnalise:true',\r\n    'filters[11]': 'cancelados:true',\r\n    'filters[12]': 'cboFiltro:',\r\n    'filters[13]': 'procedimentoFiltro:',\r\n    'filters[14]': 'reguGravidade:',\r\n    'filters[15]': 'reguIsRetorno:...',\r\n    'filters[16]': 'codBarProtocolo:',\r\n    'filters[17]': 'reguIsAgendadoFiltro:todos',\r\n    _search: 'false',\r\n    nd: Date.now(),\r\n    rows: '1000',\r\n    page: '1',\r\n    sidx: 'regu.reguDataPrevista',\r\n    sord: 'desc',\r\n  };\r\n\r\n  url.search = new URLSearchParams(params).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n\r\n  return (data?.rows || []).map((row) => {\r\n    const cell = row.cell || [];\r\n    let idp = null,\r\n      ids = null;\r\n    const idMatch = (row.id || '').match(/reguPK(\\d+)-(\\d+)/);\r\n    if (idMatch && idMatch.length === 3) {\r\n      idp = idMatch[1];\r\n      ids = idMatch[2];\r\n    }\r\n\r\n    const descriptionHtml = cell[6] || '';\r\n    const [procedure, cid] = descriptionHtml.split('<br/>');\r\n\r\n    return {\r\n      id: row.id,\r\n      idp,\r\n      ids,\r\n      type: cell[2] || 'N/A',\r\n      priority: getTextFromHTML(cell[3]),\r\n      date: cell[4] || '',\r\n      status: getTextFromHTML(cell[5]),\r\n      procedure: getTextFromHTML(procedure),\r\n      cid: cid ? cid.trim() : '',\r\n      requester: cell[7] || '',\r\n      provider: cell[8] || '',\r\n      isenFullPKCrypto: cell[9] || '',\r\n    };\r\n  });\r\n}\r\n\r\nexport async function fetchAllRegulations({\r\n  isenPK,\r\n  dataInicial,\r\n  dataFinal,\r\n  type = 'all',\r\n}) {\r\n  let regulationsToFetch = [];\r\n\r\n  if (type === 'all') {\r\n    regulationsToFetch = await Promise.all([\r\n      fetchRegulations({ isenPK, modalidade: 'ENC', dataInicial, dataFinal }),\r\n      fetchRegulations({ isenPK, modalidade: 'EXA', dataInicial, dataFinal }),\r\n    ]);\r\n  } else if (type === 'ENC') {\r\n    regulationsToFetch = [\r\n      await fetchRegulations({\r\n        isenPK,\r\n        modalidade: 'ENC',\r\n        dataInicial,\r\n        dataFinal,\r\n      }),\r\n    ];\r\n  } else if (type === 'EXA') {\r\n    regulationsToFetch = [\r\n      await fetchRegulations({\r\n        isenPK,\r\n        modalidade: 'EXA',\r\n        dataInicial,\r\n        dataFinal,\r\n      }),\r\n    ];\r\n  }\r\n\r\n  const allRegulations = regulationsToFetch.flat();\r\n\r\n  const regulationsWithAttachments = await Promise.all(\r\n    allRegulations.map(async (regulation) => {\r\n      if (regulation.idp && regulation.ids) {\r\n        try {\r\n          // CORREÇÃO: Usa o ID da própria regulação como o isenPK para esta chamada específica.\r\n          const attachmentIsenPk = `${regulation.idp}-${regulation.ids}`;\r\n          const attachments = await fetchRegulationAttachments({\r\n            reguIdp: regulation.idp,\r\n            reguIds: regulation.ids,\r\n            isenPK: attachmentIsenPk,\r\n          });\r\n          return { ...regulation, attachments };\r\n        } catch (error) {\r\n          console.warn(\r\n            `Falha ao buscar anexos para regulação ${regulation.id}:`,\r\n            error\r\n          );\r\n          return { ...regulation, attachments: [] };\r\n        }\r\n      }\r\n      return { ...regulation, attachments: [] };\r\n    })\r\n  );\r\n\r\n  regulationsWithAttachments.sort((a, b) => {\r\n    const dateA = a.date.split('/').reverse().join('-');\r\n    const dateB = b.date.split('/').reverse().join('-');\r\n    return new Date(dateB) - new Date(dateA);\r\n  });\r\n\r\n  return regulationsWithAttachments;\r\n}\r\n\r\n/**\r\n * Busca a lista de documentos anexados ao cadastro de um paciente.\r\n * @param {object} params\r\n * @param {string} params.isenPK - O PK do paciente no formato \"idp-ids\".\r\n * @returns {Promise<Array<object>>} Uma lista de objetos de documento.\r\n */\r\nexport async function fetchDocuments({ isenPK }) {\r\n  if (!isenPK) throw new Error('ID (isenPK) do paciente é necessário.');\r\n  const [idp, ids] = isenPK.split('-');\r\n  if (!idp || !ids)\r\n    throw new Error('ID (isenPK) do paciente em formato inválido.');\r\n\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/isar/buscaGrid`);\r\n  const params = {\r\n    'isenPK.idp': idp,\r\n    'isenPK.ids': ids,\r\n    _search: 'false',\r\n    nd: Date.now(),\r\n    rows: '999',\r\n    page: '1',\r\n    sidx: 'isar.isarData desc, isar.isarPK.idp',\r\n    sord: 'desc',\r\n  };\r\n  url.search = new URLSearchParams(params).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n\r\n  return (data?.rows || []).map((row) => {\r\n    const cell = row.cell || [];\r\n    return {\r\n      idp: cell[0],\r\n      ids: cell[1],\r\n      date: cell[2] || '',\r\n      description: (cell[3] || '').trim(),\r\n      fileType: (cell[4] || '').toLowerCase(),\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Obtém a URL de visualização para um documento específico.\r\n * @param {object} params\r\n * @param {string} params.idp - O IDP do documento.\r\n * @param {string} params.ids - O IDS do documento.\r\n * @returns {Promise<string|null>} A URL completa para visualização do arquivo.\r\n */\r\nexport async function fetchDocumentUrl({ idp, ids }) {\r\n  if (!idp || !ids) throw new Error('IDs do documento são necessários.');\r\n\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/isar/getHashArquivo`);\r\n  url.search = new URLSearchParams({\r\n    'isarPK.idp': idp,\r\n    'isarPK.ids': ids,\r\n  }).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n\r\n  if (data?.isenArquivo?.img) {\r\n    const filePath = data.isenArquivo.img;\r\n    return filePath.startsWith('http') ? filePath : `${baseUrl}${filePath}`;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Busca a lista de arquivos anexados a uma solicitação de regulação específica.\r\n * @param {object} params\r\n * @param {string} params.reguIdp - O IDP da regulação.\r\n * @param {string} params.reguIds - O IDS da regulação.\r\n * @param {string} params.isenPK - O PK do paciente no formato \"idp-ids\".\r\n * @returns {Promise<Array<object>>} Uma lista de objetos de anexo.\r\n */\r\nexport async function fetchRegulationAttachments({ reguIdp, reguIds, isenPK }) {\r\n  if (!reguIdp || !reguIds) throw new Error('ID da regulação é necessário.');\r\n  if (!isenPK) throw new Error('ID do paciente (isenPK) é necessário.');\r\n\r\n  const [isenIdp, isenIds] = isenPK.split('-');\r\n  if (!isenIdp || !isenIds)\r\n    throw new Error('ID do paciente (isenPK) em formato inválido.');\r\n\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/rear/buscaGrid`);\r\n  const params = {\r\n    'isenPK.idp': isenIdp,\r\n    'isenPK.ids': isenIds,\r\n    'reguPK.idp': reguIdp,\r\n    'reguPK.ids': reguIds,\r\n    _search: 'false',\r\n    nd: Date.now(),\r\n    rows: '999',\r\n    page: '1',\r\n    sidx: '', // Corrigido para corresponder à requisição da aplicação\r\n    sord: 'asc', // Corrigido para corresponder à requisição da aplicação\r\n  };\r\n  url.search = new URLSearchParams(params).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n\r\n  return (data?.rows || []).map((row) => {\r\n    const cell = row.cell || [];\r\n    return {\r\n      idp: cell[0],\r\n      ids: cell[1],\r\n      date: cell[2] || '',\r\n      description: (cell[3] || '').trim(),\r\n      fileType: (cell[4] || '').toLowerCase(),\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Obtém a URL de visualização para um anexo de regulação específico.\r\n * @param {object} params\r\n * @param {string} params.idp - O IDP do anexo (rearPK.idp).\r\n * @param {string} params.ids - O IDS do anexo (rearPK.ids).\r\n * @returns {Promise<string|null>} A URL completa para visualização do arquivo.\r\n */\r\nexport async function fetchRegulationAttachmentUrl({ idp, ids }) {\r\n  if (!idp || !ids) throw new Error('IDs do anexo são necessários.');\r\n\r\n  const baseUrl = await getBaseUrl();\r\n  const url = new URL(`${baseUrl}/sigss/rear/getHashArquivo`);\r\n  url.search = new URLSearchParams({\r\n    'rearPK.idp': idp,\r\n    'rearPK.ids': ids,\r\n  }).toString();\r\n\r\n  const response = await fetch(url, {\r\n    headers: {\r\n      Accept: 'application/json, text/javascript, */*; q=0.01',\r\n      'X-Requested-With': 'XMLHttpRequest',\r\n    },\r\n  });\r\n\r\n  if (!response.ok) handleFetchError(response);\r\n  const data = await response.json();\r\n\r\n  if (data?.regulacaoArquivo?.img) {\r\n    const filePath = data.regulacaoArquivo.img;\r\n    return filePath.startsWith('http') ? filePath : `${baseUrl}${filePath}`;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Fetches all data sources for the patient timeline concurrently.\r\n * @param {object} params - The parameters for the API calls.\r\n * @returns {Promise<object>} An object containing the data from all sources.\r\n */\r\nexport async function fetchAllTimelineData({\r\n  isenPK,\r\n  isenFullPKCrypto,\r\n  dataInicial,\r\n  dataFinal,\r\n}) {\r\n  // Usando um objeto de promessas para tornar a extração de resultados mais robusta.\r\n  const dataPromises = {\r\n    consultations: fetchAllConsultations({\r\n      isenFullPKCrypto,\r\n      dataInicial,\r\n      dataFinal,\r\n    }),\r\n    exams: fetchExamesSolicitados({\r\n      isenPK,\r\n      dataInicial,\r\n      dataFinal,\r\n      comResultado: true,\r\n      semResultado: true,\r\n    }),\r\n    appointments: fetchAppointments({ isenPK, dataInicial, dataFinal }),\r\n    regulations: fetchAllRegulations({\r\n      isenPK,\r\n      dataInicial,\r\n      dataFinal,\r\n      type: 'all',\r\n    }),\r\n    documents: fetchDocuments({ isenPK }),\r\n  };\r\n\r\n  const results = await Promise.allSettled(Object.values(dataPromises));\r\n  const dataKeys = Object.keys(dataPromises);\r\n\r\n  const getValueOrDefault = (result, defaultValue = []) => {\r\n    if (result.status === 'fulfilled') {\r\n      if (result.value && typeof result.value.jsonData !== 'undefined') {\r\n        return result.value.jsonData; // For consultations\r\n      }\r\n      return result.value; // For others\r\n    }\r\n    console.warn('Falha em chamada de API para a timeline:', result.reason);\r\n    return defaultValue;\r\n  };\r\n\r\n  const timelineData = {};\r\n  dataKeys.forEach((key, index) => {\r\n    timelineData[key] = getValueOrDefault(results[index]);\r\n  });\r\n\r\n  return timelineData;\r\n}\r\n\r\n/**\r\n * Envia uma requisição para manter a sessão ativa no sistema.\r\n * @returns {Promise<boolean>} True se a requisição foi bem-sucedida, false caso contrário.\r\n */\r\nexport async function keepSessionAlive() {\r\n  try {\r\n    const baseUrl = await getBaseUrl();\r\n    const url = new URL(`${baseUrl}/sigss/common/dataHora`);\r\n\r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        Accept: 'application/json, text/javascript, */*; q=0.01',\r\n        'X-Requested-With': 'XMLHttpRequest',\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      console.warn(`Keep-alive falhou com status ${response.status}`);\r\n      return false;\r\n    }\r\n\r\n    const data = await response.json();\r\n    console.log('Sessão mantida ativa:', data);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Erro ao manter sessão ativa:', error);\r\n    return false;\r\n  }\r\n}\r\n","/*\r\n * Copyright (c) 2016-2019, 2021-2022  Mozilla Foundation.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n'use strict';\r\n\r\nif (typeof browser === 'undefined' && typeof chrome !== 'undefined') {\r\n  var browser = chrome;\r\n}\r\n","/**\r\n * Define a configuração padrão para os campos da ficha do paciente.\r\n * Este é o \"molde\" que a extensão usará se nenhuma configuração personalizada for encontrada.\r\n *\r\n * Estrutura de cada objeto de campo:\r\n * - id: Um identificador único para o campo (usado no HTML).\r\n * - key: O caminho para acessar o dado no objeto da ficha LOCAL (ex: 'entidadeFisica.entidade.entiNome').\r\n * - cadsusKey: O índice do dado correspondente no array 'cell' do CADSUS. Null se não houver correspondência.\r\n * - label: O nome do campo exibido na interface (pode ser editado pelo usuário).\r\n * - enabled: Se o campo deve ser exibido por padrão.\r\n * - section: Onde o campo aparece por padrão ('main' para sempre visível, 'more' para \"Mostrar Mais\").\r\n * - formatter: (Opcional) Uma função para formatar o valor antes da exibição e comparação.\r\n */\r\n\r\n// Função para obter um valor aninhado de um objeto de forma segura\r\nconst getNestedValue = (obj, path) => {\r\n  if (!path) return undefined;\r\n  return path.split('.').reduce((acc, part) => acc && acc[part], obj);\r\n};\r\n\r\n// Função para normalizar e formatar telefones para exibição\r\nconst formatPhone = (value) => {\r\n  if (!value) return '';\r\n  // Remove todos os caracteres não numéricos, incluindo o DDI 55 que pode vir do CADSUS\r\n  const digits = String(value).replace(/\\D/g, '').replace(/^55/, '');\r\n  if (digits.length === 11) {\r\n    // (XX) XXXXX-XXXX\r\n    return digits.replace(/(\\d{2})(\\d{5})(\\d{4})/, '($1) $2-$3');\r\n  }\r\n  if (digits.length === 10) {\r\n    // (XX) XXXX-XXXX\r\n    return digits.replace(/(\\d{2})(\\d{4})(\\d{4})/, '($1) $2-$3');\r\n  }\r\n  return value; // Retorna original se não corresponder\r\n};\r\n\r\n// Formatter para valores 't' (true) e 'f' (false)\r\nconst formatBoolean = (value) => {\r\n  if (value === 't' || value === true) return 'Sim';\r\n  if (value === 'f' || value === false) return 'Não';\r\n  return value;\r\n};\r\n\r\nexport const defaultFieldConfig = [\r\n  // --- Seção Principal (Main) ---\r\n  {\r\n    id: 'nomeCompleto',\r\n    key: 'entidadeFisica.entidade.entiNome',\r\n    cadsusKey: 2,\r\n    label: 'Nome',\r\n    enabled: true,\r\n    section: 'main',\r\n    order: 1,\r\n  },\r\n  {\r\n    id: 'cpf',\r\n    key: 'entidadeFisica.entfCPF',\r\n    cadsusKey: 50,\r\n    label: 'CPF',\r\n    enabled: true,\r\n    section: 'main',\r\n    order: 2,\r\n    formatter: (value) => String(value || '').replace(/\\D/g, ''), // Normaliza para comparação\r\n  },\r\n  {\r\n    id: 'cns',\r\n    key: 'isenNumCadSus',\r\n    cadsusKey: (cell) =>\r\n      (String(cell[1]) || '')\r\n        .split('\\n')[0]\r\n        .replace(/\\s*\\(.*\\)/, '')\r\n        .trim(),\r\n    label: 'CNS',\r\n    enabled: true,\r\n    section: 'main',\r\n    order: 3,\r\n  },\r\n  {\r\n    id: 'nomeMae',\r\n    key: 'entidadeFisica.entfNomeMae',\r\n    cadsusKey: 7,\r\n    label: 'Nome da Mãe',\r\n    enabled: true,\r\n    section: 'main',\r\n    order: 4,\r\n  },\r\n  {\r\n    id: 'dtNasc',\r\n    key: 'entidadeFisica.entfDtNasc',\r\n    cadsusKey: 3,\r\n    label: 'Nascimento',\r\n    enabled: true,\r\n    section: 'main',\r\n    order: 5,\r\n  },\r\n  {\r\n    id: 'telefone',\r\n    key: (data) =>\r\n      `${data.entidadeFisica?.entidade?.entiTel1Pre || ''}${\r\n        data.entidadeFisica?.entidade?.entiTel1 || ''\r\n      }`,\r\n    cadsusKey: 16,\r\n    label: 'Telefone',\r\n    enabled: true,\r\n    section: 'main',\r\n    order: 6,\r\n    formatter: formatPhone,\r\n  },\r\n  // --- Seção \"Mostrar Mais\" (More) ---\r\n  {\r\n    id: 'nomeSocial',\r\n    key: 'entidadeFisica.entidade.entiNomeSocial',\r\n    cadsusKey: null,\r\n    label: 'Nome Social',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 1,\r\n  },\r\n  {\r\n    id: 'rg',\r\n    key: 'entidadeFisica.entfRG',\r\n    cadsusKey: 51, // CORRIGIDO\r\n    label: 'RG',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 2,\r\n  },\r\n  {\r\n    id: 'endereco',\r\n    key: (data) =>\r\n      `${\r\n        data.entidadeFisica?.entidade?.logradouro?.tipoLogradouro?.tiloNome ||\r\n        ''\r\n      } ${String(data.entidadeFisica?.entidade?.logradouro?.logrNome || '')\r\n        .split('/')[0]\r\n        .trim()}`.trim(),\r\n    cadsusKey: (cell) =>\r\n      `${String(cell[35] || '')} ${String(cell[34] || '')\r\n        .split('/')[0]\r\n        .trim()}`.trim(),\r\n    label: 'Endereço',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 3,\r\n  },\r\n  {\r\n    id: 'bairro',\r\n    key: 'entidadeFisica.entidade.localidade.locaNome',\r\n    cadsusKey: 30,\r\n    label: 'Bairro',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 4,\r\n  },\r\n  {\r\n    id: 'cidade',\r\n    key: 'entidadeFisica.entidade.localidade.cidade.cidaNome',\r\n    cadsusKey: 29,\r\n    label: 'Cidade',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 5,\r\n  },\r\n  {\r\n    id: 'cep',\r\n    key: 'entidadeFisica.entidade.entiEndeCEP',\r\n    cadsusKey: 41,\r\n    label: 'CEP',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 6,\r\n    formatter: (value) => String(value || '').replace(/\\D/g, ''), // Normaliza para comparação\r\n  },\r\n  {\r\n    id: 'alergiaMedicamentos',\r\n    key: 'isenAlergMedicamentos',\r\n    cadsusKey: null,\r\n    label: 'Alergia a Medicamentos',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 7,\r\n  },\r\n  {\r\n    id: 'alergiaAlimentos',\r\n    key: 'isenAlergAlimentos',\r\n    cadsusKey: null,\r\n    label: 'Alergia a Alimentos',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 8,\r\n  },\r\n  {\r\n    id: 'alergiaQuimicos',\r\n    key: 'isenAlergElementosQuimicos',\r\n    cadsusKey: null,\r\n    label: 'Alergia a Químicos',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 9,\r\n  },\r\n  {\r\n    id: 'acamado',\r\n    key: 'isenIsAcamado',\r\n    cadsusKey: null,\r\n    label: 'Acamado',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 10,\r\n    formatter: formatBoolean,\r\n  },\r\n  {\r\n    id: 'deficiente',\r\n    key: 'isenPessoaDeficiente',\r\n    cadsusKey: null,\r\n    label: 'Pessoa com Deficiência',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 11,\r\n    formatter: formatBoolean,\r\n  },\r\n  {\r\n    id: 'gemeo',\r\n    key: 'isenPossuiIrmaoGemeo',\r\n    cadsusKey: null,\r\n    label: 'Possui Irmão Gêmeo',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 12,\r\n    formatter: formatBoolean,\r\n  },\r\n  {\r\n    id: 'statusCadastro',\r\n    key: 'status.valor',\r\n    cadsusKey: null,\r\n    label: 'Status do Cadastro',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 13,\r\n  },\r\n  {\r\n    id: 'unidadeSaude',\r\n    key: 'unidadeSaude.entidade.entiNome',\r\n    cadsusKey: null,\r\n    label: 'Unidade de Saúde',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 14,\r\n  },\r\n  {\r\n    id: 'observacao',\r\n    key: 'entidadeFisica.entidade.entiObs',\r\n    cadsusKey: null,\r\n    label: 'Observação do Cadastro',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 15,\r\n  },\r\n  {\r\n    id: 'nomePai',\r\n    key: 'entidadeFisica.entfNomePai',\r\n    cadsusKey: 8, // CORRIGIDO\r\n    label: 'Nome do Pai',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 16,\r\n  },\r\n  {\r\n    id: 'racaCor',\r\n    key: 'entidadeFisica.racaCor.racoNome',\r\n    cadsusKey: 11, // CORRIGIDO\r\n    label: 'Raça/Cor',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 17,\r\n  },\r\n  {\r\n    id: 'grauInstrucao',\r\n    key: 'entidadeFisica.grauInstrucao.grinNome',\r\n    cadsusKey: null,\r\n    label: 'Grau de Instrução',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 18,\r\n  },\r\n  {\r\n    id: 'cidadeNascimento',\r\n    key: 'entidadeFisica.cidadeNasc.cidaNome',\r\n    cadsusKey: 45, // CORRIGIDO\r\n    label: 'Cidade de Nascimento',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 19,\r\n  },\r\n  {\r\n    id: 'nacionalidade',\r\n    key: 'entidadeFisica.nacionalidade.naciDescricao',\r\n    cadsusKey: 23, // CORRIGIDO\r\n    label: 'Nacionalidade',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 20,\r\n  },\r\n  {\r\n    id: 'religiao',\r\n    key: 'entidadeFisica.religiao.reliNome',\r\n    cadsusKey: null,\r\n    label: 'Religião',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 21,\r\n  },\r\n  {\r\n    id: 'cbo',\r\n    key: 'entidadeFisica.cbo.dcboNome',\r\n    cadsusKey: null,\r\n    label: 'Profissão (CBO)',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 22,\r\n  },\r\n  {\r\n    id: 'pis',\r\n    key: 'entidadeFisica.entfPis',\r\n    cadsusKey: 55, // CORRIGIDO\r\n    label: 'PIS',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 23,\r\n  },\r\n  {\r\n    id: 'ctps',\r\n    key: (data) => {\r\n      const ctps = data.entidadeFisica?.entfCTPS || '';\r\n      const serie = data.entidadeFisica?.entfCTPSSerie || '';\r\n      if (!ctps) return '';\r\n      return `${ctps} (Série: ${serie})`;\r\n    },\r\n    cadsusKey: null,\r\n    label: 'CTPS',\r\n    enabled: false,\r\n    section: 'more',\r\n    order: 24,\r\n  },\r\n  {\r\n    id: 'convulsivo',\r\n    key: 'isenIsConvulsivo',\r\n    cadsusKey: null,\r\n    label: 'É Convulsivo',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 25,\r\n    formatter: formatBoolean,\r\n  },\r\n  {\r\n    id: 'bpc',\r\n    key: 'isenRecebeBPC',\r\n    cadsusKey: null,\r\n    label: 'Recebe BPC',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 26,\r\n    formatter: formatBoolean,\r\n  },\r\n  {\r\n    id: 'autista',\r\n    key: 'isenEspectroAutista',\r\n    cadsusKey: null,\r\n    label: 'Espectro Autista',\r\n    enabled: true,\r\n    section: 'more',\r\n    order: 27,\r\n    formatter: formatBoolean,\r\n  },\r\n];\r\n\r\n// Exporta a função para obter valores, será útil no sidebar.js\r\nexport { getNestedValue };\r\n","/**\r\n * Define a configuração padrão para todos os filtros disponíveis na extensão.\r\n * Este arquivo centraliza a definição de cada filtro, que será usado tanto\r\n * na página de opções (para configurar a disposição) quanto na barra lateral\r\n * (para renderização e funcionamento).\r\n *\r\n * Estrutura de cada objeto de filtro:\r\n * - id: Identificador único do elemento HTML.\r\n * - label: O texto que descreve o filtro na interface.\r\n * - type: O tipo de elemento ('text', 'select', 'checkbox', 'selectGroup', 'component').\r\n * - section: A qual seção principal o filtro pertence.\r\n * - defaultLocation: Onde o filtro aparece por padrão ('main' ou 'more').\r\n * - componentName: (Apenas para type 'component') O nome do componente a ser renderizado.\r\n * - placeholder: (Opcional) Texto de exemplo para campos de texto.\r\n * - options: (Opcional) Um array de objetos {value, text} para 'select' ou 'selectGroup'.\r\n * - defaultChecked: (Opcional) Estado padrão para 'checkbox'.\r\n */\r\n\r\nexport const filterConfig = {\r\n  consultations: [\r\n    {\r\n      id: 'consultation-date-range',\r\n      label: 'Filtro de Datas',\r\n      type: 'component',\r\n      componentName: 'date-range',\r\n      section: 'consultations',\r\n      defaultLocation: 'main',\r\n    },\r\n    {\r\n      id: 'consultation-filter-keyword',\r\n      label: 'Busca por Palavra-chave',\r\n      type: 'text',\r\n      section: 'consultations',\r\n      defaultLocation: 'main',\r\n      placeholder: 'Busque em todo o conteúdo...',\r\n    },\r\n    {\r\n      id: 'hide-no-show-checkbox',\r\n      label: 'Ocultar faltas',\r\n      type: 'checkbox',\r\n      section: 'consultations',\r\n      defaultLocation: 'main',\r\n      defaultChecked: false,\r\n    },\r\n    {\r\n      id: 'fetch-type-buttons',\r\n      label: 'Tipo de Consulta',\r\n      type: 'selectGroup',\r\n      section: 'consultations',\r\n      defaultLocation: 'more',\r\n      options: [\r\n        { value: 'all', text: 'Todas' },\r\n        { value: 'basic', text: 'Básicas' },\r\n        { value: 'specialized', text: 'Especializadas' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'consultation-filter-cid',\r\n      label: 'CID/CIAP',\r\n      type: 'text',\r\n      section: 'consultations',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Ex: A09, Z00...',\r\n    },\r\n    {\r\n      id: 'consultation-filter-specialty',\r\n      label: 'Especialidade',\r\n      type: 'text',\r\n      section: 'consultations',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite especialidades, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'consultation-filter-professional',\r\n      label: 'Profissional',\r\n      type: 'text',\r\n      section: 'consultations',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite nomes, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'consultation-filter-unit',\r\n      label: 'Unidade de Saúde',\r\n      type: 'text',\r\n      section: 'consultations',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite unidades, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'consultation-saved-filters',\r\n      label: 'Filtros Salvos',\r\n      type: 'component',\r\n      componentName: 'saved-filters',\r\n      section: 'consultations',\r\n      defaultLocation: 'more',\r\n    },\r\n  ],\r\n  exams: [\r\n    {\r\n      id: 'exam-date-range',\r\n      label: 'Filtro de Datas',\r\n      type: 'component',\r\n      componentName: 'date-range',\r\n      section: 'exams',\r\n      defaultLocation: 'main',\r\n    },\r\n    {\r\n      id: 'exam-fetch-type-buttons',\r\n      label: 'Status do Resultado',\r\n      type: 'selectGroup',\r\n      section: 'exams',\r\n      defaultLocation: 'main',\r\n      options: [\r\n        { value: 'all', text: 'Todos' },\r\n        { value: 'withResult', text: 'Com Resultado' },\r\n        { value: 'withoutResult', text: 'Sem Resultado' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'exam-filter-name',\r\n      label: 'Nome do Exame',\r\n      type: 'text',\r\n      section: 'exams',\r\n      defaultLocation: 'main',\r\n      placeholder: 'Digite nomes, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'exam-filter-professional',\r\n      label: 'Profissional Solicitante',\r\n      type: 'text',\r\n      section: 'exams',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite nomes, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'exam-filter-specialty',\r\n      label: 'Especialidade Solicitante',\r\n      type: 'text',\r\n      section: 'exams',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite especialidades, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'exam-saved-filters',\r\n      label: 'Filtros Salvos',\r\n      type: 'component',\r\n      componentName: 'saved-filters',\r\n      section: 'exams',\r\n      defaultLocation: 'more',\r\n    },\r\n  ],\r\n  appointments: [\r\n    {\r\n      id: 'appointment-date-range',\r\n      label: 'Filtro de Datas',\r\n      type: 'component',\r\n      componentName: 'date-range',\r\n      section: 'appointments',\r\n      defaultLocation: 'main',\r\n    },\r\n    {\r\n      id: 'appointment-fetch-type-buttons',\r\n      label: 'Tipo de Agendamento',\r\n      type: 'selectGroup',\r\n      section: 'appointments',\r\n      defaultLocation: 'main',\r\n      options: [\r\n        { value: 'all', text: 'Todos' },\r\n        { value: 'consultas', text: 'Consultas' },\r\n        { value: 'exames', text: 'Exames' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'appointment-filter-status',\r\n      label: 'Status',\r\n      type: 'select',\r\n      section: 'appointments',\r\n      defaultLocation: 'main',\r\n      options: [\r\n        { value: 'todos', text: 'Todos' },\r\n        { value: 'AGENDADO', text: 'Agendado' },\r\n        { value: 'PRESENTE', text: 'Presente' },\r\n        { value: 'FALTOU', text: 'Faltou' },\r\n        { value: 'CANCELADO', text: 'Cancelado' },\r\n        { value: 'ATENDIDO', text: 'Atendido' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'appointment-filter-term',\r\n      label: 'Busca por Termo',\r\n      type: 'text',\r\n      section: 'appointments',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Profissional, especialidade...',\r\n    },\r\n    {\r\n      id: 'appointment-filter-location',\r\n      label: 'Local',\r\n      type: 'text',\r\n      section: 'appointments',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite locais, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'appointment-saved-filters',\r\n      label: 'Filtros Salvos',\r\n      type: 'component',\r\n      componentName: 'saved-filters',\r\n      section: 'appointments',\r\n      defaultLocation: 'more',\r\n    },\r\n  ],\r\n  regulations: [\r\n    {\r\n      id: 'regulation-date-range',\r\n      label: 'Filtro de Datas',\r\n      type: 'component',\r\n      componentName: 'date-range',\r\n      section: 'regulations',\r\n      defaultLocation: 'main',\r\n    },\r\n    {\r\n      id: 'regulation-fetch-type-buttons',\r\n      label: 'Modalidade',\r\n      type: 'selectGroup',\r\n      section: 'regulations',\r\n      defaultLocation: 'main',\r\n      options: [\r\n        { value: 'all', text: 'Todos' },\r\n        { value: 'ENC', text: 'Consultas' },\r\n        { value: 'EXA', text: 'Exames' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'regulation-filter-status',\r\n      label: 'Status',\r\n      type: 'select',\r\n      section: 'regulations',\r\n      defaultLocation: 'main',\r\n      options: [\r\n        { value: 'todos', text: 'Todos' },\r\n        { value: 'AUTORIZADO', text: 'Autorizado' },\r\n        { value: 'PENDENTE', text: 'Pendente' },\r\n        { value: 'NEGADO', text: 'Negado' },\r\n        { value: 'DEVOLVIDO', text: 'Devolvido' },\r\n        { value: 'CANCELADA', text: 'Cancelada' },\r\n        { value: 'EM ANÁLISE', text: 'Em Análise' },\r\n      ],\r\n    },\r\n    {\r\n      id: 'regulation-filter-priority',\r\n      label: 'Prioridade',\r\n      type: 'select',\r\n      section: 'regulations',\r\n      defaultLocation: 'more',\r\n      options: [\r\n        { value: 'todas', text: 'Todas' }, // Opções serão populadas dinamicamente\r\n      ],\r\n    },\r\n    {\r\n      id: 'regulation-filter-procedure',\r\n      label: 'Procedimento/Especialidade',\r\n      type: 'text',\r\n      section: 'regulations',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Ex: Ortopedia, Raio X...',\r\n    },\r\n    {\r\n      id: 'regulation-filter-requester',\r\n      label: 'Profissional/Unidade Solicitante',\r\n      type: 'text',\r\n      section: 'regulations',\r\n      defaultLocation: 'more',\r\n      placeholder: 'Digite nomes, separe por vírgula...',\r\n    },\r\n    {\r\n      id: 'regulation-saved-filters',\r\n      label: 'Filtros Salvos',\r\n      type: 'component',\r\n      componentName: 'saved-filters',\r\n      section: 'regulations',\r\n      defaultLocation: 'more',\r\n    },\r\n  ],\r\n  documents: [\r\n    {\r\n      id: 'document-date-range',\r\n      label: 'Filtro de Datas',\r\n      type: 'component',\r\n      componentName: 'date-range',\r\n      section: 'documents',\r\n      defaultLocation: 'main',\r\n    },\r\n    {\r\n      id: 'document-filter-keyword',\r\n      label: 'Busca por Palavra-chave',\r\n      type: 'text',\r\n      section: 'documents',\r\n      defaultLocation: 'main',\r\n      placeholder: 'Busque na descrição do documento...',\r\n    },\r\n  ],\r\n};\r\n","/**\r\n * @file Contém todas as funções responsáveis por gerar o HTML dos resultados.\r\n */\r\n\r\nimport { getSortIndicator } from './SectionManager.js';\r\nimport * as Utils from './utils.js';\r\n\r\nexport function renderConsultations(consultations, sortState) {\r\n  const contentDiv = document.getElementById('consultations-content');\r\n  if (!contentDiv) return;\r\n\r\n  if (consultations.length === 0) {\r\n    contentDiv.innerHTML =\r\n      '<p class=\"text-slate-500\">Nenhuma consulta encontrada para os filtros aplicados.</p>';\r\n    return;\r\n  }\r\n  const headers = `\r\n    <div class=\"flex justify-between text-xs font-bold text-slate-500 mb-2 px-3\">\r\n        <span class=\"sort-header w-2/3\" data-sort-key=\"specialty\">Especialidade/Profissional <span class=\"sort-indicator\">${getSortIndicator(\r\n    'specialty',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/3 text-right\" data-sort-key=\"sortableDate\">Data <span class=\"sort-indicator\">${getSortIndicator(\r\n    'sortableDate',\r\n    sortState\r\n  )}</span></span>\r\n    </div>\r\n  `;\r\n  contentDiv.innerHTML =\r\n    headers +\r\n    consultations\r\n      .map(\r\n        (c) => `\r\n        <div class=\"p-3 mb-3 border rounded-lg ${\r\n  c.isNoShow ? 'bg-red-50 border-red-200' : 'bg-white'\r\n} consultation-item\">\r\n            <div class=\"flex justify-between items-start cursor-pointer consultation-header\">\r\n                <div>\r\n                    <p class=\"font-bold text-blue-700 pointer-events-none\">${\r\n  c.specialty\r\n}</p>\r\n                    <p class=\"text-sm text-slate-600 pointer-events-none\">${\r\n  c.professional\r\n}</p>\r\n                </div>\r\n                <p class=\"text-sm font-medium text-slate-800 bg-slate-100 px-2 py-1 rounded whitespace-pre-wrap text-right pointer-events-none\">${c.date.replace(\r\n    /\\n/g,\r\n    '<br>'\r\n  )}</p>\r\n            </div>\r\n            <div class=\"consultation-body collapse-section show\">\r\n                ${\r\n  c.isNoShow\r\n    ? '<p class=\"text-center font-bold text-red-600 mt-2\">PACIENTE FALTOU</p>'\r\n    : `\r\n                <p class=\"text-sm text-slate-500 mt-1\">${c.unit}</p>\r\n                <div class=\"mt-3 pt-3 border-t border-slate-200 space-y-2\">\r\n                    ${c.details\r\n    .map(\r\n      (d) =>\r\n        `<p class=\"text-xs font-semibold text-slate-500 uppercase\">${\r\n          d.label\r\n        }</p><p class=\"text-sm text-slate-700 whitespace-pre-wrap\">${d.value.replace(\r\n          /\\n/g,\r\n          '<br>'\r\n        )} <span class=\"copy-icon\" title=\"Copiar\" data-copy-text=\"${\r\n          d.value\r\n        }\">📄</span></p>`\r\n    )\r\n    .join('')}\r\n                </div>`\r\n}\r\n            </div>\r\n        </div>\r\n    `\r\n      )\r\n      .join('');\r\n}\r\n\r\nexport function renderExams(exams, sortState) {\r\n  const contentDiv = document.getElementById('exams-content');\r\n  if (!contentDiv) return;\r\n\r\n  if (exams.length === 0) {\r\n    contentDiv.innerHTML =\r\n      '<p class=\"text-slate-500\">Nenhum exame encontrado para os filtros aplicados.</p>';\r\n    return;\r\n  }\r\n  const headers = `\r\n    <div class=\"flex justify-between text-xs font-bold text-slate-500 mb-2 px-3\">\r\n        <span class=\"sort-header w-2/3\" data-sort-key=\"examName\">Nome do Exame <span class=\"sort-indicator\">${getSortIndicator(\r\n    'examName',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/3 text-right\" data-sort-key=\"date\">Data <span class=\"sort-indicator\">${getSortIndicator(\r\n    'date',\r\n    sortState\r\n  )}</span></span>\r\n    </div>\r\n  `;\r\n  contentDiv.innerHTML =\r\n    headers +\r\n    exams\r\n      .map((exam) => {\r\n        const idp = exam.resultIdp;\r\n        const ids = exam.resultIds;\r\n        const idpStr = idp !== null && idp !== undefined ? String(idp) : '';\r\n        const idsStr = ids !== null && ids !== undefined ? String(ids) : '';\r\n        const showBtn =\r\n          exam.hasResult &&\r\n          idp !== null &&\r\n          idp !== undefined &&\r\n          ids !== null &&\r\n          ids !== undefined &&\r\n          idpStr !== '' &&\r\n          idsStr !== '';\r\n        return `\r\n        <div class=\"p-3 mb-3 border rounded-lg bg-white\">\r\n            <p class=\"font-semibold text-indigo-700\">${\r\n  exam.examName || 'Nome do exame não informado'\r\n} <span class=\"copy-icon\" title=\"Copiar\" data-copy-text=\"${\r\n  exam.examName\r\n}\">📄</span></p>\r\n            <div class=\"text-sm text-slate-500 mt-1\">\r\n                <p>Solicitado por: ${exam.professional || 'Não informado'} (${\r\n  exam.specialty || 'N/A'\r\n})</p>\r\n                <p>Data: ${exam.date || 'Não informada'}</p>\r\n            </div>\r\n            ${\r\n  showBtn\r\n    ? `<button class=\"view-exam-result-btn mt-2 w-full text-sm bg-green-100 text-green-800 py-1 rounded hover:bg-green-200\" data-idp=\"${idpStr}\" data-ids=\"${idsStr}\">Visualizar Resultado</button>`\r\n    : ''\r\n}\r\n        </div>\r\n      `;\r\n      })\r\n      .join('');\r\n}\r\n\r\nexport function renderAppointments(appointments, sortState) {\r\n  const contentDiv = document.getElementById('appointments-content');\r\n  if (!contentDiv) return;\r\n\r\n  const statusStyles = {\r\n    AGENDADO: 'bg-blue-100 text-blue-800',\r\n    PRESENTE: 'bg-green-100 text-green-800',\r\n    FALTOU: 'bg-red-100 text-red-800',\r\n    CANCELADO: 'bg-yellow-100 text-yellow-800',\r\n    ATENDIDO: 'bg-purple-100 text-purple-800',\r\n  };\r\n\r\n  if (appointments.length === 0) {\r\n    contentDiv.innerHTML =\r\n      '<p class=\"text-slate-500\">Nenhum agendamento encontrado para o filtro selecionado.</p>';\r\n    return;\r\n  }\r\n  const headers = `\r\n    <div class=\"flex justify-between text-xs font-bold text-slate-500 mb-2 px-3\">\r\n        <span class=\"sort-header w-1/2\" data-sort-key=\"specialty\">Especialidade <span class=\"sort-indicator\">${getSortIndicator(\r\n    'specialty',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/4 text-center\" data-sort-key=\"status\">Status <span class=\"sort-indicator\">${getSortIndicator(\r\n    'status',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/4 text-right\" data-sort-key=\"date\">Data <span class=\"sort-indicator\">${getSortIndicator(\r\n    'date',\r\n    sortState\r\n  )}</span></span>\r\n    </div>\r\n  `;\r\n  contentDiv.innerHTML =\r\n    headers +\r\n    appointments\r\n      .map((item) => {\r\n        const style = statusStyles[item.status] || 'bg-gray-100 text-gray-800';\r\n        let typeText = item.type;\r\n        if (item.isSpecialized) {\r\n          typeText = 'CONSULTA ESPECIALIZADA';\r\n        } else if (item.isOdonto) {\r\n          typeText = 'CONSULTA ODONTO';\r\n        } else if (item.type.toUpperCase().includes('EXAME')) {\r\n          typeText = 'EXAME';\r\n        }\r\n\r\n        const [idp, ids] = item.id.split('-');\r\n\r\n        return `\r\n        <div class=\"p-3 mb-3 border rounded-lg bg-white\">\r\n            <div class=\"flex justify-between items-start\">\r\n                <div>\r\n                    <p class=\"font-semibold text-gray-800\">${typeText}</p>\r\n                    <p class=\"text-sm text-indigo-600 font-medium\">${\r\n  item.specialty || 'Sem especialidade'\r\n}</p>\r\n                </div>\r\n                <span class=\"text-xs font-bold px-2 py-1 rounded-full ${style}\">${\r\n  item.status\r\n}</span>\r\n            </div>\r\n            <div class=\"text-sm text-slate-500 mt-2 border-t pt-2\">\r\n                <p><strong>Data:</strong> ${item.date} às ${item.time}</p>\r\n                <p><strong>Local:</strong> ${item.location}</p>\r\n                <p><strong>Profissional:</strong> ${item.professional}</p>\r\n            </div>\r\n            <div class=\"flex items-center justify-between mt-2 pt-2 border-t\">\r\n                 <button class=\"view-appointment-details-btn text-sm bg-gray-100 text-gray-800 py-1 px-3 rounded hover:bg-gray-200\" data-idp=\"${\r\n  idp || ''\r\n}\" data-ids=\"${ids || ''}\" data-type=\"${item.type}\">\r\n                    Ver Detalhes\r\n                </button>\r\n            </div>\r\n        </div>\r\n      `;\r\n      })\r\n      .join('');\r\n}\r\n\r\nexport function renderRegulations(regulations, sortState, globalSettings) {\r\n  const contentDiv = document.getElementById('regulations-content');\r\n  if (!contentDiv) return;\r\n\r\n  const priorityNameMap = new Map();\r\n  const priorityColorMap = new Map();\r\n  if (globalSettings && globalSettings.regulationPriorities) {\r\n    globalSettings.regulationPriorities.forEach((prio) => {\r\n      priorityNameMap.set(prio.coreDescricao, prio.coreDescricao);\r\n      priorityColorMap.set(prio.coreDescricao, prio.coreCor);\r\n    });\r\n  }\r\n\r\n  const statusStyles = {\r\n    AUTORIZADO: 'bg-green-100 text-green-800',\r\n    PENDENTE: 'bg-yellow-100 text-yellow-800',\r\n    NEGADO: 'bg-red-100 text-red-800',\r\n    DEVOLVIDO: 'bg-orange-100 text-orange-800',\r\n    CANCELADA: 'bg-gray-100 text-gray-800',\r\n    'EM ANÁLISE': 'bg-blue-100 text-blue-800',\r\n  };\r\n\r\n  if (regulations.length === 0) {\r\n    contentDiv.innerHTML =\r\n      '<p class=\"text-slate-500\">Nenhum resultado encontrado para os filtros aplicados.</p>';\r\n    return;\r\n  }\r\n  const headers = `\r\n    <div class=\"flex justify-between text-xs font-bold text-slate-500 mb-2 px-3\">\r\n        <span class=\"sort-header w-1/2\" data-sort-key=\"procedure\">Procedimento <span class=\"sort-indicator\">${getSortIndicator(\r\n    'procedure',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/4 text-center\" data-sort-key=\"status\">Status <span class=\"sort-indicator\">${getSortIndicator(\r\n    'status',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/4 text-right\" data-sort-key=\"date\">Data <span class=\"sort-indicator\">${getSortIndicator(\r\n    'date',\r\n    sortState\r\n  )}</span></span>\r\n    </div>\r\n  `;\r\n  contentDiv.innerHTML =\r\n    headers +\r\n    regulations\r\n      .map((item) => {\r\n        const statusKey = (item.status || '').toUpperCase();\r\n        const style = statusStyles[statusKey] || 'bg-gray-100 text-gray-800';\r\n\r\n        const priorityKey = (item.priority || '').toUpperCase();\r\n        const priorityColor = priorityColorMap.get(priorityKey) || 'CCCCCC';\r\n        const textColor = Utils.getContrastYIQ(priorityColor);\r\n        const priorityStyle = `background-color: #${priorityColor}; color: ${textColor};`;\r\n        const priorityText = priorityNameMap.get(priorityKey) || item.priority;\r\n\r\n        const typeText = (item.type || '').startsWith('CON')\r\n          ? 'CONSULTA'\r\n          : 'EXAME';\r\n        const typeColor =\r\n          typeText === 'CONSULTA' ? 'text-cyan-700' : 'text-fuchsia-700';\r\n\r\n        const attachmentsHtml =\r\n          item.attachments && item.attachments.length > 0\r\n            ? `\r\n            <div class=\"mt-2 pt-2 border-t border-slate-100\">\r\n                <p class=\"text-xs font-semibold text-slate-500 mb-1\">ANEXOS:</p>\r\n                <div class=\"space-y-1\">\r\n                    ${item.attachments\r\n    .map(\r\n      (att) => `\r\n                        <button class=\"view-regulation-attachment-btn w-full text-left text-sm bg-gray-50 text-gray-700 py-1 px-2 rounded hover:bg-gray-100 flex justify-between items-center\" data-idp=\"${\r\n  att.idp\r\n}\" data-ids=\"${att.ids}\">\r\n                            <div class=\"flex items-center gap-2 overflow-hidden\">\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"currentColor\" class=\"flex-shrink-0\" viewBox=\"0 0 16 16\"><path d=\"M4 0h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zM2 2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2z\"/><path d=\"M4.5 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z\"/></svg>\r\n                                <span class=\"truncate\" title=\"${\r\n  att.description\r\n} (${att.fileType.toUpperCase()})\">${\r\n  att.description\r\n} (${att.fileType.toUpperCase()})</span>\r\n                            </div>\r\n                            <span class=\"text-xs text-slate-400 flex-shrink-0 ml-2\">${\r\n  att.date\r\n}</span>\r\n                        </button>`\r\n    )\r\n    .join('')}\r\n                </div>\r\n            </div>\r\n            `\r\n            : '';\r\n\r\n        return `\r\n            <div class=\"p-3 mb-3 border rounded-lg bg-white\">\r\n                <div class=\"flex justify-between items-start\">\r\n                    <div>\r\n                        <div class=\"flex items-center gap-2 mb-1\">\r\n                           <p class=\"font-bold ${typeColor}\">${typeText}</p>\r\n                           <span class=\"text-xs font-bold px-2 py-0.5 rounded-full\" style=\"${priorityStyle}\">${priorityText}</span>\r\n                        </div>\r\n                        <p class=\"text-sm text-slate-800 font-medium\">${\r\n  item.procedure\r\n} <span class=\"copy-icon\" title=\"Copiar\" data-copy-text=\"${\r\n  item.procedure\r\n}\">📄</span></p>\r\n                        <p class=\"text-xs text-slate-500\">${\r\n  item.cid\r\n} <span class=\"copy-icon\" title=\"Copiar\" data-copy-text=\"${\r\n  item.cid\r\n}\">📄</span></p>\r\n                    </div>\r\n                    <span class=\"text-xs font-bold px-2 py-1 rounded-full ${style}\">${\r\n  item.status\r\n}</span>\r\n                </div>\r\n                <div class=\"text-sm text-slate-500 mt-2 border-t pt-2 space-y-1\">\r\n                    <p><strong>Data:</strong> ${item.date}</p>\r\n                    <p><strong>Solicitante:</strong> ${item.requester}</p>\r\n                    <p><strong>Executante:</strong> ${\r\n  item.provider || 'Não definido'\r\n}</p>\r\n                </div>\r\n                <div class=\"mt-2 pt-2 border-t\">\r\n                     <button class=\"view-regulation-details-btn w-full text-sm bg-gray-100 text-gray-800 py-1 px-3 rounded hover:bg-gray-200\" data-idp=\"${\r\n  item.idp\r\n}\" data-ids=\"${item.ids}\">\r\n                        Visualizar Detalhes\r\n                    </button>\r\n                </div>\r\n                ${attachmentsHtml}\r\n            </div>\r\n      `;\r\n      })\r\n      .join('');\r\n}\r\n\r\nexport function renderDocuments(documents, sortState) {\r\n  const contentDiv = document.getElementById('documents-content');\r\n  if (!contentDiv) return;\r\n\r\n  if (!documents || documents.length === 0) {\r\n    contentDiv.innerHTML =\r\n      '<p class=\"text-slate-500\">Nenhum documento encontrado.</p>';\r\n    return;\r\n  }\r\n\r\n  const headers = `\r\n    <div class=\"flex justify-between text-xs font-bold text-slate-500 mb-2 px-3\">\r\n        <span class=\"sort-header w-2/3\" data-sort-key=\"description\">Descrição <span class=\"sort-indicator\">${getSortIndicator(\r\n    'description',\r\n    sortState\r\n  )}</span></span>\r\n        <span class=\"sort-header w-1/3 text-right\" data-sort-key=\"date\">Data <span class=\"sort-indicator\">${getSortIndicator(\r\n    'date',\r\n    sortState\r\n  )}</span></span>\r\n    </div>\r\n  `;\r\n\r\n  contentDiv.innerHTML =\r\n    headers +\r\n    documents\r\n      .map(\r\n        (doc) => `\r\n        <div class=\"p-3 mb-2 border rounded-lg bg-white\">\r\n            <p class=\"font-semibold text-gray-800\">${doc.description}</p>\r\n            <div class=\"text-sm text-slate-500 mt-1\">\r\n                <span>Data: ${doc.date}</span> |\r\n                <span class=\"font-medium\">Tipo: ${doc.fileType.toUpperCase()}</span>\r\n            </div>\r\n            <button class=\"view-document-btn mt-2 w-full text-sm bg-gray-100 text-gray-800 py-1 rounded hover:bg-gray-200\" data-idp=\"${\r\n  doc.idp\r\n}\" data-ids=\"${doc.ids}\">\r\n                Visualizar Documento\r\n            </button>\r\n        </div>\r\n      `\r\n      )\r\n      .join('');\r\n}\r\n\r\n/**\r\n * Renders the timeline based on the provided events and status.\r\n * @param {Array<object>} events - The array of timeline event objects.\r\n * @param {'loading'|'empty'|'error'|'success'} status - The current status of the timeline.\r\n */\r\nexport function renderTimeline(events, status) {\r\n  const contentDiv = document.getElementById('timeline-content');\r\n  if (!contentDiv) return;\r\n\r\n  const eventTypeStyles = {\r\n    consultation: {\r\n      label: 'Consulta',\r\n      color: 'blue',\r\n      bgColorClass: 'bg-blue-100',\r\n      iconColorClass: 'text-blue-600',\r\n      icon: 'M11 2v2M5 2v2M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1M8 15a6 6 0 0 0 12 0v-3m-6-5a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z',\r\n    },\r\n    exam: {\r\n      label: 'Exame',\r\n      color: 'green',\r\n      bgColorClass: 'bg-green-100',\r\n      iconColorClass: 'text-green-600',\r\n      icon: 'M6 18h8M3 22h18M14 22a7 7 0 1 0 0-14h-1M9 14h2M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2ZM12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3',\r\n    },\r\n    appointment: {\r\n      label: 'Agendamento',\r\n      color: 'purple',\r\n      bgColorClass: 'bg-purple-100',\r\n      iconColorClass: 'text-purple-600',\r\n      icon: 'M8 2v4M16 2v4M3 10h18M3 4h18v16H3zM9 16l2 2 4-4',\r\n    },\r\n    regulation: {\r\n      label: 'Regulação',\r\n      color: 'red',\r\n      bgColorClass: 'bg-red-100',\r\n      iconColorClass: 'text-red-600',\r\n      icon: 'M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1zM9 12l2 2 4-4',\r\n    },\r\n    // --- INÍCIO DA MODIFICAÇÃO ---\r\n    document: {\r\n      label: 'Documento',\r\n      color: 'gray',\r\n      bgColorClass: 'bg-gray-100',\r\n      iconColorClass: 'text-gray-600',\r\n      icon: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z M14 2v6h6',\r\n    },\r\n    // --- FIM DA MODIFICAÇÃO ---\r\n  };\r\n\r\n  let contentHtml = '';\r\n\r\n  switch (status) {\r\n  case 'loading':\r\n    contentHtml =\r\n        '<p class=\"text-slate-500 text-center\">A carregar linha do tempo...</p>';\r\n    break;\r\n  case 'empty':\r\n    contentHtml =\r\n        '<p class=\"text-slate-500 text-center\">Nenhum evento encontrado para este paciente.</p>';\r\n    break;\r\n  case 'error':\r\n    contentHtml =\r\n        '<p class=\"text-red-500 text-center\">Ocorreu um erro ao carregar os dados. Tente novamente.</p>';\r\n    break;\r\n  case 'success':\r\n    if (events.length === 0) {\r\n      contentHtml =\r\n          '<p class=\"text-slate-500 text-center\">Nenhum evento encontrado para os filtros aplicados.</p>';\r\n      break;\r\n    }\r\n    contentHtml = '<div class=\"relative space-y-4\">';\r\n    contentHtml +=\r\n        '<div class=\"absolute left-4 top-2 bottom-2 w-0.5 bg-slate-200\"></div>';\r\n\r\n    contentHtml += events\r\n      .map((event) => {\r\n        const style = eventTypeStyles[event.type] || {\r\n          label: 'Evento',\r\n          color: 'gray',\r\n          icon: '',\r\n        };\r\n        const dateString =\r\n            event.date instanceof Date && !isNaN(event.date)\r\n              ? event.date.toLocaleDateString('pt-BR')\r\n              : 'Data Inválida';\r\n\r\n        let topRightDetailsHtml = '';\r\n        let extraInfoHtml = '';\r\n\r\n        if (event.type === 'appointment') {\r\n          const a = event.details;\r\n          const [idp, ids] = a.id.split('-');\r\n\r\n          const statusStyles = {\r\n            AGENDADO: 'text-blue-600',\r\n            PRESENTE: 'text-green-600',\r\n            FALTOU: 'text-red-600',\r\n            CANCELADO: 'text-yellow-600',\r\n            ATENDIDO: 'text-purple-600',\r\n          };\r\n          const statusClass =\r\n              statusStyles[a.status] || 'text-slate-600';\r\n          const timeHtml = `<div class=\"text-xs text-slate-500\">às ${a.time}</div>`;\r\n          const statusHtml = `<div class=\"mt-1 text-xs font-semibold ${statusClass}\">${a.status}</div>`;\r\n\r\n          const icon = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-file-search-2\"><path d=\"M14 2v6h6\"/><path d=\"M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4\"/><path d=\"M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z\"/><path d=\"m9 21-1.5-1.5\"/></svg>';\r\n          const detailsButtonHtml = `<button class=\"view-appointment-details-btn mt-2 text-xs bg-gray-100 text-gray-800 py-1 px-3 rounded hover:bg-gray-200 flex items-center gap-1\" data-idp=\"${idp}\" data-ids=\"${ids}\" data-type=\"${a.type}\">${icon}<span>Detalhes</span></button>`;\r\n\r\n          topRightDetailsHtml = timeHtml + statusHtml + detailsButtonHtml;\r\n        } else if (event.type === 'exam') {\r\n          const statusText = event.details.hasResult\r\n            ? 'Com Resultado'\r\n            : 'Sem Resultado';\r\n          const statusClass = event.details.hasResult\r\n            ? 'text-green-600'\r\n            : 'text-yellow-600';\r\n          topRightDetailsHtml = `<div class=\"mt-1 text-xs font-semibold ${statusClass}\">${statusText}</div>`;\r\n          if (\r\n            event.details.hasResult &&\r\n              event.details.resultIdp &&\r\n              event.details.resultIds\r\n          ) {\r\n            topRightDetailsHtml += `<button class=\"view-exam-result-btn mt-2 text-xs bg-green-100 text-green-800 py-1 px-3 rounded hover:bg-green-200\" data-idp=\"${event.details.resultIdp}\" data-ids=\"${event.details.resultIds}\">Visualizar Resultado</button>`;\r\n          }\r\n        } else if (event.type === 'regulation') {\r\n          const r = event.details;\r\n          if (r.idp && r.ids) {\r\n            const icon = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-file-search-2\"><path d=\"M14 2v6h6\"/><path d=\"M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4\"/><path d=\"M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z\"/><path d=\"m9 21-1.5-1.5\"/></svg>';\r\n            topRightDetailsHtml = `<button class=\"view-regulation-details-btn mt-2 text-xs bg-gray-100 text-gray-800 py-1 px-3 rounded hover:bg-gray-200 flex items-center gap-1\" data-idp=\"${r.idp}\" data-ids=\"${r.ids}\">${icon}<span>Detalhes</span></button>`;\r\n          }\r\n        }\r\n\r\n        if (event.type === 'consultation') {\r\n          const c = event.details;\r\n          const icon = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-file-search-2\"><path d=\"M14 2v6h6\"/><path d=\"M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4\"/><path d=\"M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z\"/><path d=\"m9 21-1.5-1.5\"/></svg>';\r\n          topRightDetailsHtml = `<button class=\"timeline-toggle-details-btn mt-2 text-xs bg-gray-100 text-gray-800 py-1 px-3 rounded hover:bg-gray-200 flex items-center gap-1\">${icon}<span>Detalhes</span></button>`;\r\n            \r\n          extraInfoHtml = `\r\n                <div class=\"timeline-details-body mt-2 pt-2 border-t border-slate-200\">\r\n                    <p class=\"text-sm text-slate-500 mb-2\">${c.unit}</p>\r\n                    ${c.details\r\n    .map(\r\n      (d) => `\r\n                        <p class=\"text-xs font-semibold text-slate-500 uppercase mb-1\">${\r\n  d.label\r\n}</p>\r\n                        <p class=\"text-sm text-slate-700 mb-2\">${d.value.replace(\r\n    /\\n/g,\r\n    '<br>'\r\n  )} <span class=\"copy-icon\" title=\"Copiar\" data-copy-text=\"${\r\n  d.value\r\n}\">📄</span></p>\r\n                    `\r\n    )\r\n    .join('')}\r\n                </div>\r\n            `;\r\n        } else if (event.type === 'regulation') {\r\n          const r = event.details;\r\n          const attachmentsHtml =\r\n              r.attachments && r.attachments.length > 0\r\n                ? `\r\n                <div class=\"mt-2 pt-2 border-t border-slate-100\">\r\n                    <p class=\"text-xs font-semibold text-slate-500 mb-1\">ANEXOS:</p>\r\n                    <div class=\"space-y-1\">\r\n                        ${r.attachments\r\n    .map(\r\n      (att) => `\r\n                            <button class=\"view-regulation-attachment-btn w-full text-left text-sm bg-gray-50 text-gray-700 py-1 px-2 rounded hover:bg-gray-100 flex justify-between items-center\" data-idp=\"${\r\n  att.idp\r\n}\" data-ids=\"${att.ids}\">\r\n                                <div class=\"flex items-center gap-2 overflow-hidden\">\r\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" fill=\"currentColor\" class=\"flex-shrink-0\" viewBox=\"0 0 16 16\"><path d=\"M4 0h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zM2 2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2z\"/><path d=\"M4.5 12.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-2a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z\"/></svg>\r\n                                    <span class=\"truncate\" title=\"${\r\n  att.description\r\n} (${att.fileType.toUpperCase()})\">${\r\n  att.description\r\n} (${att.fileType.toUpperCase()})</span>\r\n                                </div>\r\n                                <span class=\"text-xs text-slate-400 flex-shrink-0 ml-2\">${\r\n  att.date\r\n}</span>\r\n                            </button>\r\n                        `\r\n    )\r\n    .join('')}\r\n                    </div>\r\n                </div>\r\n                `\r\n                : '';\r\n\r\n          extraInfoHtml = `\r\n                <div class=\"timeline-details-body mt-2 pt-2 border-t border-slate-200 text-sm\">\r\n                    <p class=\"mb-1\"><strong>Status:</strong> ${r.status}</p>\r\n                    <p class=\"mb-1\"><strong>Prioridade:</strong> ${r.priority}</p>\r\n                    <p class=\"mb-1\"><strong>CID:</strong> ${r.cid}</p>\r\n                    <p class=\"mb-2\"><strong>Executante:</strong> ${\r\n  r.provider || 'Não definido'\r\n}</p>\r\n                    ${attachmentsHtml}\r\n                </div>\r\n            `;\r\n          // --- INÍCIO DA MODIFICAÇÃO ---\r\n        } else if (event.type === 'document') {\r\n          const doc = event.details;\r\n          extraInfoHtml = `\r\n                <div class=\"timeline-details-body mt-2 pt-2 border-t border-slate-200\">\r\n                    <button class=\"view-document-btn w-full text-sm bg-gray-100 text-gray-800 py-1 rounded hover:bg-gray-200\" data-idp=\"${doc.idp}\" data-ids=\"${doc.ids}\">\r\n                        Visualizar Documento\r\n                    </button>\r\n                </div>\r\n            `;\r\n        }\r\n        // --- FIM DA MODIFICAÇÃO ---\r\n\r\n        return `\r\n                    <div class=\"relative pl-10 timeline-item\" data-event-type=\"${event.type}\">\r\n                        <div class=\"absolute left-4 top-2 -ml-[15px] h-[30px] w-[30px] rounded-full ${style.bgColorClass} border-2 border-white flex items-center justify-center ${style.iconColorClass}\" title=\"${style.label}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n                                <path d=\"${style.icon}\" />\r\n                            </svg>\r\n                        </div>\r\n                        <div class=\"bg-slate-50 p-3 rounded-lg border border-slate-200\">\r\n                            <div class=\"timeline-header cursor-pointer\">\r\n                                <div class=\"flex justify-between items-start\">\r\n                                    <div>\r\n                                        <p class=\"text-sm font-semibold text-${style.color}-700\">${event.title}</p>\r\n                                        <p class=\"text-xs text-slate-600\">${event.summary}</p>\r\n                                    </div>\r\n                                    <div class=\"text-right flex-shrink-0 ml-2\">\r\n                                        <p class=\"text-xs font-medium text-slate-500\">${dateString}</p>\r\n                                        ${topRightDetailsHtml}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            ${extraInfoHtml}\r\n                        </div>\r\n                    </div>\r\n                `;\r\n      })\r\n      .join('');\r\n    contentHtml += '</div>';\r\n    break;\r\n  }\r\n  contentDiv.innerHTML = contentHtml;\r\n}\r\n","/**\r\n * @file store.js - Gestor de estado centralizado para a aplicação.\r\n * Implementa um padrão simples de \"publish-subscribe\" para gerir o estado global.\r\n */\r\n\r\nconst state = {\r\n  currentPatient: {\r\n    ficha: null,\r\n    cadsus: null,\r\n    lastCadsusCheck: null,\r\n    isUpdating: false,\r\n  },\r\n  recentPatients: [],\r\n  savedFilterSets: {},\r\n};\r\n\r\nconst listeners = [];\r\n\r\nexport const store = {\r\n  /**\r\n   * Adiciona uma função de callback à lista de listeners.\r\n   * @param {Function} listener A função a ser adicionada.\r\n   * @returns {Function} Uma função para remover o listener (unsubscribe).\r\n   */\r\n  subscribe(listener) {\r\n    listeners.push(listener);\r\n    // PASSO 3.3: Retorna uma função de unsubscribe para melhor gestão de memória.\r\n    return () => {\r\n      const index = listeners.indexOf(listener);\r\n      if (index > -1) {\r\n        listeners.splice(index, 1);\r\n      }\r\n    };\r\n  },\r\n\r\n  _notify() {\r\n    for (const listener of listeners) {\r\n      try {\r\n        listener();\r\n      } catch (error) {\r\n        console.error('Erro num listener do store:', error);\r\n      }\r\n    }\r\n  },\r\n\r\n  setPatient(fichaData, cadsusData) {\r\n    state.currentPatient.ficha = fichaData;\r\n    state.currentPatient.cadsus = cadsusData;\r\n    state.currentPatient.lastCadsusCheck = cadsusData ? new Date() : null;\r\n    state.currentPatient.isUpdating = false;\r\n    this._notify();\r\n  },\r\n\r\n  clearPatient() {\r\n    state.currentPatient.ficha = null;\r\n    state.currentPatient.cadsus = null;\r\n    state.currentPatient.lastCadsusCheck = null;\r\n    state.currentPatient.isUpdating = false;\r\n    this._notify();\r\n  },\r\n\r\n  setPatientUpdating() {\r\n    state.currentPatient.isUpdating = true;\r\n    this._notify();\r\n  },\r\n\r\n  getPatient() {\r\n    return state.currentPatient.ficha ? state.currentPatient : null;\r\n  },\r\n\r\n  setRecentPatients(patients) {\r\n    state.recentPatients = patients;\r\n    this._notify();\r\n  },\r\n\r\n  getRecentPatients() {\r\n    return state.recentPatients;\r\n  },\r\n\r\n  setSavedFilterSets(sets) {\r\n    state.savedFilterSets = sets;\r\n    this._notify();\r\n  },\r\n\r\n  getSavedFilterSets() {\r\n    return state.savedFilterSets;\r\n  },\r\n\r\n  getState() {\r\n    return {\r\n      currentPatient: { ...state.currentPatient },\r\n      recentPatients: [...state.recentPatients],\r\n      savedFilterSets: { ...state.savedFilterSets },\r\n    };\r\n  },\r\n};\r\n","/**\r\n * @file Módulo para gerir o card de \"Dados do Paciente\".\r\n */\r\nimport * as Utils from '../utils.js';\r\nimport { store } from '../store.js';\r\n\r\nlet patientDetailsSection,\r\n  patientMainInfoDiv,\r\n  patientAdditionalInfoDiv,\r\n  toggleDetailsBtn,\r\n  patientCardFooter,\r\n  cadsusTimestamp,\r\n  refreshCadsusBtn;\r\nlet fieldConfigLayout = [];\r\nlet onForceRefresh; // Callback para forçar a atualização\r\n\r\n/**\r\n * Renderiza os detalhes do paciente no card.\r\n * @param {object} patientData - O objeto completo do paciente vindo do store.\r\n */\r\nfunction render(patientData) {\r\n  if (!patientDetailsSection || !patientData || !patientData.ficha) {\r\n    hide();\r\n    return;\r\n  }\r\n\r\n  const { ficha, cadsus, lastCadsusCheck, isUpdating } = patientData;\r\n\r\n  patientMainInfoDiv.innerHTML = '';\r\n  patientAdditionalInfoDiv.innerHTML = '';\r\n\r\n  const getLocalValue = (field, data) => {\r\n    if (typeof field.key === 'function') return field.key(data);\r\n    return Utils.getNestedValue(data, field.key);\r\n  };\r\n\r\n  const getCadsusValue = (field, data) => {\r\n    if (!data || field.cadsusKey === null) return null;\r\n    if (typeof field.cadsusKey === 'function') return field.cadsusKey(data);\r\n    return data[field.cadsusKey];\r\n  };\r\n\r\n  const sortedFields = [...fieldConfigLayout].sort((a, b) => a.order - b.order);\r\n\r\n  sortedFields.forEach((field) => {\r\n    if (!field.enabled) return;\r\n\r\n    let localValue = getLocalValue(field, ficha);\r\n    if (field.formatter) localValue = field.formatter(localValue);\r\n\r\n    let cadsusValue = getCadsusValue(field, cadsus);\r\n    if (field.formatter) cadsusValue = field.formatter(cadsusValue);\r\n\r\n    const v1 = String(localValue || '').trim();\r\n    const v2 = String(cadsusValue || '').trim();\r\n    let icon = '';\r\n\r\n    if (cadsus && field.cadsusKey !== null) {\r\n      let compareV1 = v1;\r\n      let compareV2 = v2;\r\n\r\n      if (field.id === 'telefone') {\r\n        compareV1 = v1.replace(/\\D/g, '').replace(/^55/, '');\r\n        compareV2 = v2.replace(/\\D/g, '').replace(/^55/, '');\r\n      } else {\r\n        compareV1 = Utils.normalizeString(v1);\r\n        compareV2 = Utils.normalizeString(v2);\r\n      }\r\n\r\n      if (compareV1 && compareV1 === compareV2) {\r\n        icon = '<span class=\"comparison-icon\" title=\"Dado confere com o CADSUS\">✅</span>';\r\n      } else {\r\n        const tooltipText = `Ficha: ${v1 || 'Vazio'}\\nCADSUS: ${v2 || 'Vazio'}`;\r\n        icon = `<span class=\"comparison-icon\" data-tooltip=\"${tooltipText}\">⚠️</span>`;\r\n      }\r\n    }\r\n\r\n    const valueClass =\r\n      field.id.toLowerCase().includes('alerg') && v1 && v1 !== '-'\r\n        ? 'text-red-600 font-bold'\r\n        : 'text-slate-900';\r\n    const copyIcon = v1\r\n      ? `<span class=\"copy-icon\" title=\"Copiar\" data-copy-text=\"${v1}\">📄</span>`\r\n      : '';\r\n    const rowHtml = `<div class=\"flex justify-between items-center py-1\"><span class=\"font-medium text-slate-600\">${\r\n      field.label\r\n    }:</span><span class=\"${valueClass} text-right flex items-center\">${\r\n      v1 || '-'\r\n    }${icon}${copyIcon}</span></div>`;\r\n\r\n    if (field.section === 'main') {\r\n      patientMainInfoDiv.innerHTML += rowHtml;\r\n    } else {\r\n      patientAdditionalInfoDiv.innerHTML += rowHtml;\r\n    }\r\n  });\r\n\r\n  if (lastCadsusCheck) {\r\n    cadsusTimestamp.textContent = `CADSUS verificado em: ${lastCadsusCheck.toLocaleString()}`;\r\n    patientCardFooter.style.display = 'flex';\r\n  } else {\r\n    cadsusTimestamp.textContent = 'Não foi possível verificar dados do CADSUS.';\r\n    patientCardFooter.style.display = 'flex';\r\n  }\r\n\r\n  refreshCadsusBtn\r\n    .querySelector('.refresh-icon')\r\n    .classList.toggle('spinning', isUpdating);\r\n  refreshCadsusBtn.disabled = isUpdating;\r\n\r\n  toggleDetailsBtn.style.display = sortedFields.some(\r\n    (f) => f.enabled && f.section === 'more'\r\n  )\r\n    ? 'block'\r\n    : 'none';\r\n  patientDetailsSection.style.display = 'block';\r\n}\r\n\r\nfunction hide() {\r\n  if (patientDetailsSection) patientDetailsSection.style.display = 'none';\r\n}\r\n\r\nfunction handleToggleDetails() {\r\n  patientAdditionalInfoDiv.classList.toggle('show');\r\n  toggleDetailsBtn.textContent = patientAdditionalInfoDiv.classList.contains(\r\n    'show'\r\n  )\r\n    ? 'Mostrar menos'\r\n    : 'Mostrar mais';\r\n}\r\n\r\nfunction handleForceRefresh() {\r\n  const patient = store.getPatient();\r\n  if (patient && patient.ficha && onForceRefresh) {\r\n    onForceRefresh(\r\n      { idp: patient.ficha.isenPK.idp, ids: patient.ficha.isenPK.ids },\r\n      true\r\n    );\r\n  }\r\n}\r\n\r\nfunction onStateChange() {\r\n  const patient = store.getPatient();\r\n  if (patient) {\r\n    render(patient);\r\n  } else {\r\n    hide();\r\n  }\r\n}\r\n\r\n/**\r\n * Inicializa o módulo do card de paciente.\r\n * @param {Array<object>} config - A configuração dos campos da ficha.\r\n * @param {object} callbacks - Funções de callback.\r\n * @param {Function} callbacks.onForceRefresh - Função para forçar a atualização.\r\n */\r\nexport function init(config, callbacks) {\r\n  patientDetailsSection = document.getElementById('patient-details-section');\r\n  patientMainInfoDiv = document.getElementById('patient-main-info');\r\n  patientAdditionalInfoDiv = document.getElementById('patient-additional-info');\r\n  toggleDetailsBtn = document.getElementById('toggle-details-btn');\r\n  patientCardFooter = document.getElementById('patient-card-footer');\r\n  cadsusTimestamp = document.getElementById('cadsus-timestamp');\r\n  refreshCadsusBtn = document.getElementById('refresh-cadsus-btn');\r\n\r\n  fieldConfigLayout = config;\r\n  onForceRefresh = callbacks.onForceRefresh;\r\n\r\n  toggleDetailsBtn.addEventListener('click', handleToggleDetails);\r\n  refreshCadsusBtn.addEventListener('click', handleForceRefresh);\r\n\r\n  store.subscribe(onStateChange);\r\n}\r\n","/**\r\n * @file Módulo para gerir a funcionalidade de busca de pacientes.\r\n */\r\nimport * as API from '../api.js';\r\nimport * as Utils from '../utils.js';\r\nimport { store } from '../store.js';\r\n\r\nlet searchInput;\r\nlet searchResultsList;\r\nlet recentPatientsList;\r\nlet onSelectPatient; // Callback para notificar o sidebar sobre a seleção\r\n\r\nfunction renderSearchResults(patients) {\r\n  if (!searchResultsList) return;\r\n  if (patients.length === 0) {\r\n    searchResultsList.innerHTML = '<li class=\"px-4 py-3 text-sm text-slate-500\">Nenhum paciente encontrado.</li>';\r\n    return;\r\n  }\r\n  searchResultsList.innerHTML = patients\r\n    .map(\r\n      (p) =>\r\n        `<li class=\"px-4 py-3 border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition\" data-idp=\"${\r\n          p.idp\r\n        }\" data-ids=\"${p.ids}\">${renderPatientListItem(p)}</li>`\r\n    )\r\n    .join('');\r\n}\r\n\r\n/**\r\n * Renderiza a lista de pacientes recentes a partir do store.\r\n */\r\nfunction renderRecentPatients() {\r\n  if (!recentPatientsList) return;\r\n  const recents = store.getRecentPatients() || [];\r\n  recentPatientsList.innerHTML =\r\n    '<li class=\"px-4 pt-3 pb-1 text-xs font-semibold text-slate-400\">PACIENTES RECENTES</li>' +\r\n    (recents.length === 0\r\n      ? '<li class=\"px-4 py-3 text-sm text-slate-500\">Nenhum paciente recente.</li>'\r\n      : recents\r\n        .map((p) => {\r\n          // CORREÇÃO: Lida com a estrutura de dados antiga e nova dos pacientes recentes.\r\n          const fichaData = p.ficha || p; // Se p.ficha não existe, 'p' é o próprio objeto da ficha.\r\n          const idp = fichaData.isenPK?.idp || fichaData.idp;\r\n          const ids = fichaData.isenPK?.ids || fichaData.ids;\r\n\r\n          if (!idp || !ids) return ''; // Pula a renderização se o item estiver malformado.\r\n\r\n          return `<li class=\"px-4 py-3 border-b border-slate-100 hover:bg-slate-50 cursor-pointer transition recent-patient-item\" data-idp=\"${idp}\" data-ids=\"${ids}\">${renderPatientListItem(\r\n            fichaData\r\n          )}</li>`;\r\n        })\r\n        .join(''));\r\n}\r\n\r\nfunction renderPatientListItem(patient) {\r\n  const nome =\r\n    patient.value ||\r\n    Utils.getNestedValue(patient, 'entidadeFisica.entidade.entiNome') ||\r\n    'Nome não informado';\r\n  const idp = patient.idp || patient.isenPK?.idp;\r\n  const ids = patient.ids || patient.isenPK?.ids;\r\n  const dataNascimento =\r\n    patient.dataNascimento ||\r\n    Utils.getNestedValue(patient, 'entidadeFisica.entfDtNasc');\r\n  const cpf =\r\n    patient.cpf || Utils.getNestedValue(patient, 'entidadeFisica.entfCPF');\r\n  const cns = patient.cns || patient.isenNumCadSus;\r\n  return `\r\n      <div class=\"font-medium text-slate-800\">${nome}</div>\r\n      <div class=\"grid grid-cols-2 gap-x-4 text-xs text-slate-500 mt-1\">\r\n        <span><strong class=\"font-semibold\">Cód:</strong> ${idp}-${ids}</span>\r\n        <span><strong class=\"font-semibold\">Nasc:</strong> ${\r\n  dataNascimento || '-'\r\n}</span>\r\n        <span><strong class=\"font-semibold\">CPF:</strong> ${cpf || '-'}</span>\r\n        <span><strong class=\"font-semibold\">CNS:</strong> ${cns || '-'}</span>\r\n      </div>\r\n    `;\r\n}\r\n\r\nconst handleSearchInput = Utils.debounce(async () => {\r\n  const searchTerm = searchInput.value.trim();\r\n  store.clearPatient();\r\n  recentPatientsList.classList.add('hidden');\r\n  searchResultsList.classList.remove('hidden');\r\n  if (searchTerm.length < 1) {\r\n    searchResultsList.innerHTML = '';\r\n    return;\r\n  }\r\n  Utils.toggleLoader(true);\r\n  try {\r\n    const patients = await API.searchPatients(searchTerm);\r\n    renderSearchResults(patients);\r\n  } catch (error) {\r\n    Utils.showMessage('Erro ao buscar pacientes.');\r\n  } finally {\r\n    Utils.toggleLoader(false);\r\n  }\r\n}, 500);\r\n\r\nfunction handleSearchFocus() {\r\n  if (searchInput.value.length > 0) return;\r\n  renderRecentPatients();\r\n  searchResultsList.classList.add('hidden');\r\n  recentPatientsList.classList.remove('hidden');\r\n}\r\n\r\nfunction handleSearchBlur() {\r\n  setTimeout(() => {\r\n    searchResultsList.classList.add('hidden');\r\n    recentPatientsList.classList.add('hidden');\r\n  }, 200);\r\n}\r\n\r\nasync function handleResultClick(event) {\r\n  const listItem = event.target.closest('li[data-idp]');\r\n  if (!listItem) return;\r\n\r\n  const { idp, ids } = listItem.dataset;\r\n\r\n  if (listItem.classList.contains('recent-patient-item')) {\r\n    const recentPatient = store.getRecentPatients().find((p) => {\r\n      // CORREÇÃO: Lida com a estrutura de dados antiga e nova.\r\n      const patientIdp = p.ficha ? p.ficha.isenPK.idp : p.idp;\r\n      return patientIdp == idp;\r\n    });\r\n\r\n    // Se o paciente foi encontrado e tem a nova estrutura (com cache), usa os dados do cache.\r\n    if (recentPatient && recentPatient.ficha) {\r\n      store.setPatient(recentPatient.ficha, recentPatient.cadsus);\r\n      searchInput.value = '';\r\n      searchResultsList.classList.add('hidden');\r\n      recentPatientsList.classList.add('hidden');\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Para pacientes novos ou pacientes recentes com a estrutura antiga (que precisam ser re-buscados).\r\n  if (onSelectPatient) {\r\n    onSelectPatient({ idp, ids });\r\n  }\r\n\r\n  searchInput.value = '';\r\n  searchResultsList.classList.add('hidden');\r\n  recentPatientsList.classList.add('hidden');\r\n}\r\n\r\nexport function init(config) {\r\n  searchInput = document.getElementById('patient-search-input');\r\n  searchResultsList = document.getElementById('search-results');\r\n  recentPatientsList = document.getElementById('recent-patients-list');\r\n  onSelectPatient = config.onSelectPatient;\r\n\r\n  store.subscribe(() => {\r\n    if (!recentPatientsList.classList.contains('hidden')) {\r\n      renderRecentPatients();\r\n    }\r\n  });\r\n\r\n  searchInput.addEventListener('input', handleSearchInput);\r\n  searchInput.addEventListener('focus', handleSearchFocus);\r\n  searchInput.addEventListener('blur', handleSearchBlur);\r\n  searchResultsList.addEventListener('click', handleResultClick);\r\n  recentPatientsList.addEventListener('click', handleResultClick);\r\n}\r\n","/**\r\n * @file Contém funções utilitárias compartilhadas em toda a extensão.\r\n */\r\n\r\n/**\r\n * Atraso na execução de uma função após o utilizador parar de digitar.\r\n * @param {Function} func A função a ser executada.\r\n * @param {number} [delay=500] O tempo de espera em milissegundos.\r\n * @returns {Function} A função com debounce.\r\n */\r\nexport function debounce(func, delay = 500) {\r\n  let timeoutId;\r\n  return (...args) => {\r\n    clearTimeout(timeoutId);\r\n    timeoutId = setTimeout(() => {\r\n      func.apply(this, args);\r\n    }, delay);\r\n  };\r\n}\r\n\r\n/**\r\n * Mostra ou esconde o loader principal.\r\n * @param {boolean} show - `true` para mostrar, `false` para esconder.\r\n */\r\nexport function toggleLoader(show) {\r\n  const loader = document.getElementById('loader');\r\n  if (loader) {\r\n    loader.style.display = show ? 'block' : 'none';\r\n  }\r\n}\r\n\r\n/**\r\n * Exibe uma mensagem na área de mensagens.\r\n * @param {string} text O texto da mensagem.\r\n * @param {'error' | 'success' | 'info'} [type='error'] O tipo de mensagem.\r\n */\r\nexport function showMessage(text, type = 'error') {\r\n  const messageArea = document.getElementById('message-area');\r\n  if (messageArea) {\r\n    messageArea.textContent = text;\r\n    const typeClasses = {\r\n      error: 'bg-red-100 text-red-700',\r\n      success: 'bg-green-100 text-green-700',\r\n      info: 'bg-blue-100 text-blue-700',\r\n    };\r\n    messageArea.className = `p-3 rounded-md text-sm ${\r\n      typeClasses[type] || typeClasses.error\r\n    }`;\r\n    messageArea.style.display = 'block';\r\n  }\r\n}\r\n\r\n/**\r\n * Limpa a área de mensagens.\r\n */\r\nexport function clearMessage() {\r\n  const messageArea = document.getElementById('message-area');\r\n  if (messageArea) {\r\n    messageArea.style.display = 'none';\r\n  }\r\n}\r\n\r\n/**\r\n * Converte uma string de data em vários formatos para um objeto Date.\r\n * @param {string} dateString A data no formato \"dd/MM/yyyy\" ou \"yyyy-MM-dd\", podendo conter prefixos.\r\n * @returns {Date|null} O objeto Date ou null se a string for inválida.\r\n */\r\nexport function parseDate(dateString) {\r\n  if (!dateString || typeof dateString !== 'string') return null;\r\n\r\n  // Tenta extrair o primeiro padrão de data válido da string.\r\n  const dateMatch = dateString.match(\r\n    /(\\d{4}-\\d{2}-\\d{2})|(\\d{2}\\/\\d{2}\\/\\d{2,4})/\r\n  );\r\n  if (!dateMatch) return null;\r\n\r\n  const matchedDate = dateMatch[0];\r\n  let year, month, day;\r\n\r\n  // Tenta o formato YYYY-MM-DD\r\n  if (matchedDate.includes('-')) {\r\n    [year, month, day] = matchedDate.split('-').map(Number);\r\n  } else if (matchedDate.includes('/')) {\r\n    // Tenta o formato DD/MM/YYYY\r\n    [day, month, year] = matchedDate.split('/').map(Number);\r\n  }\r\n\r\n  // Valida se os números são válidos e se a data é real\r\n  if (isNaN(year) || isNaN(month) || isNaN(day)) return null;\r\n\r\n  // Lida com anos de 2 dígitos (ex: '24' -> 2024)\r\n  if (year >= 0 && year < 100) {\r\n    year += 2000;\r\n  }\r\n\r\n  const date = new Date(Date.UTC(year, month - 1, day));\r\n\r\n  // Confirma que a data não \"rolou\" para o mês seguinte (ex: 31 de Abril -> 1 de Maio)\r\n  if (\r\n    date.getUTCFullYear() === year &&\r\n    date.getUTCMonth() === month - 1 &&\r\n    date.getUTCDate() === day\r\n  ) {\r\n    return date;\r\n  }\r\n\r\n  return null; // Retorna nulo se a data for inválida (ex: 31/02/2024)\r\n}\r\n\r\n/**\r\n * Obtém um valor aninhado de um objeto de forma segura.\r\n * @param {object} obj O objeto.\r\n * @param {string} path O caminho para a propriedade (ex: 'a.b.c').\r\n * @returns {*} O valor encontrado ou undefined.\r\n */\r\nexport const getNestedValue = (obj, path) => {\r\n  if (!path) return undefined;\r\n  return path.split('.').reduce((acc, part) => acc && acc[part], obj);\r\n};\r\n\r\n/**\r\n * Calcula uma data relativa à data atual com base num desvio em meses.\r\n * @param {number} offsetInMonths - O número de meses a adicionar ou subtrair.\r\n * @returns {Date} O objeto Date resultante.\r\n */\r\nexport function calculateRelativeDate(offsetInMonths) {\r\n  const date = new Date();\r\n  // setMonth lida corretamente com transições de ano e dias do mês\r\n  date.setMonth(date.getMonth() + offsetInMonths);\r\n  return date;\r\n}\r\n\r\n/**\r\n * Retorna 'black' ou 'white' para o texto dependendo do contraste com a cor de fundo.\r\n * @param {string} hexcolor - A cor de fundo em formato hexadecimal (com ou sem #).\r\n * @returns {'black' | 'white'}\r\n */\r\nexport function getContrastYIQ(hexcolor) {\r\n  hexcolor = hexcolor.replace('#', '');\r\n  const r = parseInt(hexcolor.substr(0, 2), 16);\r\n  const g = parseInt(hexcolor.substr(2, 2), 16);\r\n  const b = parseInt(hexcolor.substr(4, 2), 16);\r\n  const yiq = (r * 299 + g * 587 + b * 114) / 1000;\r\n  return yiq >= 128 ? 'black' : 'white';\r\n}\r\n\r\n/**\r\n * Normaliza uma string removendo acentos, cedilha e convertendo para minúsculas.\r\n * @param {string} str - A string a ser normalizada.\r\n * @returns {string} A string normalizada.\r\n */\r\nexport function normalizeString(str) {\r\n  if (!str) return '';\r\n  return str\r\n    .toString()\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '');\r\n}\r\n\r\n/**\r\n * Configura um sistema de abas (tabs) dentro de um container.\r\n * @param {HTMLElement} container - O elemento que contém os botões e os painéis das abas.\r\n */\r\nexport function setupTabs(container) {\r\n  if (!container) return;\r\n\r\n  const tabButtons = container.querySelectorAll('.tab-button');\r\n  const tabContents = container.querySelectorAll('.tab-content');\r\n\r\n  tabButtons.forEach((button) => {\r\n    button.addEventListener('click', () => {\r\n      const tabName = button.dataset.tab;\r\n      tabButtons.forEach((btn) => btn.classList.remove('active'));\r\n      tabContents.forEach((content) => content.classList.remove('active'));\r\n      button.classList.add('active');\r\n      const activeContent = container.querySelector(`#${tabName}-tab`);\r\n      if (activeContent) {\r\n        activeContent.classList.add('active');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Normalizes data from various sources into a single, sorted timeline event list.\r\n * @param {object} apiData - An object containing arrays of consultations, exams, etc.\r\n * @returns {Array<object>} A sorted array of timeline event objects.\r\n */\r\nexport function normalizeTimelineData(apiData) {\r\n  const events = [];\r\n\r\n  // Normalize Consultations\r\n  try {\r\n    (apiData.consultations || []).forEach((c) => {\r\n      if (!c || !c.date) return;\r\n      const searchText = normalizeString(\r\n        [\r\n          c.specialty,\r\n          c.professional,\r\n          c.unit,\r\n          ...c.details.map((d) => d.value),\r\n        ].join(' ')\r\n      );\r\n      events.push({\r\n        type: 'consultation',\r\n        date: parseDate(c.date.split('\\n')[0]),\r\n        sortableDate: c.sortableDate || parseDate(c.date),\r\n        title: `Consulta: ${c.specialty || 'Especialidade não informada'}`,\r\n        summary: `com ${c.professional || 'Profissional não informado'}`,\r\n        details: c,\r\n        subDetails: c.details || [],\r\n        searchText,\r\n      });\r\n    });\r\n  } catch (e) {\r\n    console.error('Failed to normalize consultation data for timeline:', e);\r\n  }\r\n\r\n  // Normalize Exams\r\n  try {\r\n    (apiData.exams || []).forEach((e) => {\r\n      const eventDate = parseDate(e.date);\r\n      if (!e || !eventDate) return;\r\n      const searchText = normalizeString(\r\n        [e.examName, e.professional, e.specialty].filter(Boolean).join(' ')\r\n      );\r\n      events.push({\r\n        type: 'exam',\r\n        date: eventDate,\r\n        sortableDate: eventDate,\r\n        title: `Exame Solicitado: ${e.examName || 'Nome não informado'}`,\r\n        summary: `Solicitado por ${e.professional || 'Não informado'}`,\r\n        details: e,\r\n        subDetails: [\r\n          {\r\n            label: 'Resultado',\r\n            value: e.hasResult ? 'Disponível' : 'Pendente',\r\n          },\r\n        ],\r\n        searchText,\r\n      });\r\n    });\r\n  } catch (e) {\r\n    console.error('Failed to normalize exam data for timeline:', e);\r\n  }\r\n\r\n  // Normalize Appointments\r\n  try {\r\n    (apiData.appointments || []).forEach((a) => {\r\n      if (!a || !a.date) return;\r\n      const searchText = normalizeString(\r\n        [a.specialty, a.description, a.location, a.professional].join(' ')\r\n      );\r\n      events.push({\r\n        type: 'appointment',\r\n        date: parseDate(a.date),\r\n        sortableDate: parseDate(a.date),\r\n        title: `Agendamento: ${a.specialty || a.description || 'Não descrito'}`,\r\n        summary: a.location || 'Local não informado',\r\n        details: a,\r\n        subDetails: [\r\n          { label: 'Status', value: a.status || 'N/A' },\r\n          { label: 'Hora', value: a.time || 'N/A' },\r\n        ],\r\n        searchText,\r\n      });\r\n    });\r\n  } catch (e) {\r\n    console.error('Failed to normalize appointment data for timeline:', e);\r\n  }\r\n\r\n  // Normalize Regulations\r\n  try {\r\n    (apiData.regulations || []).forEach((r) => {\r\n      if (!r || !r.date) return;\r\n      const searchText = normalizeString(\r\n        [r.procedure, r.requester, r.provider, r.cid].join(' ')\r\n      );\r\n      events.push({\r\n        type: 'regulation',\r\n        date: parseDate(r.date),\r\n        sortableDate: parseDate(r.date),\r\n        title: `Regulação: ${r.procedure || 'Procedimento não informado'}`,\r\n        summary: `Solicitante: ${r.requester || 'Não informado'}`,\r\n        details: r,\r\n        subDetails: [\r\n          { label: 'Status', value: r.status || 'N/A' },\r\n          { label: 'Prioridade', value: r.priority || 'N/A' },\r\n        ],\r\n        searchText,\r\n      });\r\n    });\r\n  } catch (e) {\r\n    console.error('Failed to normalize regulation data for timeline:', e);\r\n  }\r\n\r\n  // --- INÍCIO DA MODIFICAÇÃO ---\r\n  // Normalize Documents\r\n  try {\r\n    (apiData.documents || []).forEach((doc) => {\r\n      if (!doc || !doc.date) return;\r\n      const searchText = normalizeString(doc.description || '');\r\n      events.push({\r\n        type: 'document',\r\n        date: parseDate(doc.date),\r\n        sortableDate: parseDate(doc.date),\r\n        title: `Documento: ${doc.description || 'Sem descrição'}`,\r\n        summary: `Tipo: ${doc.fileType.toUpperCase()}`,\r\n        details: doc,\r\n        subDetails: [],\r\n        searchText,\r\n      });\r\n    });\r\n  } catch (e) {\r\n    console.error('Failed to normalize document data for timeline:', e);\r\n  }\r\n  // --- FIM DA MODIFICAÇÃO ---\r\n\r\n  // Filter out events with invalid dates and sort all events by date, newest first.\r\n  return events\r\n    .filter(\r\n      (event) =>\r\n        event.sortableDate instanceof Date && !isNaN(event.sortableDate)\r\n    )\r\n    .sort((a, b) => b.sortableDate - a.sortableDate);\r\n}\r\n\r\n/**\r\n * Filters timeline events based on automation rule filters.\r\n * @param {Array<object>} events - The full array of timeline events.\r\n * @param {object} automationFilters - The filter settings from an automation rule.\r\n * @returns {Array<object>} A new array with the filtered events.\r\n */\r\nexport function filterTimelineEvents(events, automationFilters) {\r\n  if (!automationFilters) return events;\r\n\r\n  const checkText = (text, filterValue) => {\r\n    if (!filterValue) return true; // If filter is empty, it passes\r\n    const terms = filterValue\r\n      .toLowerCase()\r\n      .split(',')\r\n      .map((t) => t.trim())\r\n      .filter(Boolean);\r\n    if (terms.length === 0) return true;\r\n    const normalizedText = normalizeString(text || '');\r\n    return terms.some((term) => normalizedText.includes(term));\r\n  };\r\n\r\n  return events.filter((event) => {\r\n    try {\r\n      switch (event.type) {\r\n      case 'consultation': {\r\n        const consultFilters = automationFilters.consultations || {};\r\n        // Procura por um campo rotulado como CID ou CIAP para uma busca precisa.\r\n        const cidDetail = (event.details.details || []).find(\r\n          (d) =>\r\n            normalizeString(d.label).includes('cid') ||\r\n              normalizeString(d.label).includes('ciap')\r\n        );\r\n        const cidText = cidDetail ? cidDetail.value : '';\r\n        return (\r\n          checkText(\r\n            event.details.specialty,\r\n            consultFilters['consultation-filter-specialty']\r\n          ) &&\r\n            checkText(\r\n              event.details.professional,\r\n              consultFilters['consultation-filter-professional']\r\n            ) &&\r\n            checkText(cidText, consultFilters['consultation-filter-cid'])\r\n        );\r\n      }\r\n\r\n      case 'exam': {\r\n        const examFilters = automationFilters.exams || {};\r\n        return (\r\n          checkText(\r\n            event.details.examName,\r\n            examFilters['exam-filter-name']\r\n          ) &&\r\n            checkText(\r\n              event.details.professional,\r\n              examFilters['exam-filter-professional']\r\n            ) &&\r\n            checkText(\r\n              event.details.specialty,\r\n              examFilters['exam-filter-specialty']\r\n            )\r\n        );\r\n      }\r\n\r\n      case 'appointment': {\r\n        const apptFilters = automationFilters.appointments || {};\r\n        const apptText = `${event.details.specialty} ${event.details.professional} ${event.details.location}`;\r\n        return checkText(apptText, apptFilters['appointment-filter-term']);\r\n      }\r\n\r\n      case 'regulation': {\r\n        const regFilters = automationFilters.regulations || {};\r\n        return (\r\n          checkText(\r\n            event.details.procedure,\r\n            regFilters['regulation-filter-procedure']\r\n          ) &&\r\n            checkText(\r\n              event.details.requester,\r\n              regFilters['regulation-filter-requester']\r\n            ) &&\r\n            (regFilters['regulation-filter-status'] === 'todos' ||\r\n              !regFilters['regulation-filter-status'] ||\r\n              event.details.status.toUpperCase() ===\r\n                regFilters['regulation-filter-status'].toUpperCase()) &&\r\n            (regFilters['regulation-filter-priority'] === 'todas' ||\r\n              !regFilters['regulation-filter-priority'] ||\r\n              event.details.priority.toUpperCase() ===\r\n                regFilters['regulation-filter-priority'].toUpperCase())\r\n        );\r\n      }\r\n\r\n      default:\r\n        return true;\r\n      }\r\n    } catch (e) {\r\n      console.warn(\r\n        'Error filtering timeline event, it will be included by default:',\r\n        event,\r\n        e\r\n      );\r\n      return true;\r\n    }\r\n  });\r\n}\r\n"],"names":["API","KeepAliveManager","constructor","intervalId","isActive","intervalMinutes","init","loadSettings","browser","storage","onChanged","addListener","changes","areaName","keepSessionAliveInterval","updateInterval","newValue","api","chrome","result","sync","get","error","console","minutes","newMinutes","parseInt","stop","start","log","intervalMs","setInterval","success","keepSessionAlive","Date","toLocaleTimeString","warn","clearInterval","getStatus","nextExecution","now","filterConfig","Utils","store","getSortIndicator","key","state","order","SectionManager","sectionKey","config","globalSettings","prefix","getPrefix","allData","currentPatient","isLoading","sortState","initialSortState","fetchType","elements","map","consultations","exams","appointments","regulations","documents","cacheDomElements","renderFilterControls","addEventListeners","subscribe","onStateChange","_this$currentPatient","_this$currentPatient$","_newPatient$isenPK","patientState","getPatient","newPatient","ficha","isenPK","idp","setPatient","populateSavedFilterDropdown","section","document","getElementById","wrapper","content","fetchBtn","toggleBtn","toggleMoreBtn","clearBtn","mainFilters","moreFilters","automationFeedback","_this$elements$fetchB","_this$elements$toggle","_this$elements$toggle2","_this$elements$clearB","_this$elements$sectio","_this$elements$sectio2","_this$elements$sectio3","addEventListener","fetchData","toggleSection","toggleMoreFilters","clearFilters","debounce","e","target","matches","applyFiltersAndRender","closest","handleFetchTypeChange","id","loadFilterSet","sortHeader","handleSort","dataset","sortKey","saveFilterSet","deleteFilterSet","clearAutomationFeedbackAndFilters","patient","style","display","userPreferences","charAt","toUpperCase","slice","showMessage","innerHTML","_this$elements$mainFi","fetchTypeElement","querySelector","value","dataInicialValue","dateInitial","dataFinalValue","dateFinal","params","ids","isenFullPKCrypto","dataInicial","toLocaleDateString","dataFinal","type","comResultado","semResultado","fetchFunction","Array","isArray","jsonData","sectionNameMap","friendlyName","filteredData","filterLogic","getFilterValues","sortedData","sortData","renderFunction","updateActiveFiltersIndicator","data","sort","a","b","valA","valB","sortableDate","parseDate","date","toString","toLowerCase","values","filters","forEach","filter","el","checked","_this$elements$wrappe","classList","toggle","textContent","contains","shouldShow","shouldRender","sectionLayout","filterLayout","layoutMap","Map","f","dateRangeDefaults","defaultRanges","end","range","valueAsDate","calculateRelativeDate","savedFilterSettings","defaultValue","undefined","_filter$defaultChecke","defaultChecked","options","element","_this$elements$toggle3","indicator","isShown","activeCount","filterElements","querySelectorAll","trim","remove","add","name","window","prompt","savedSets","getSavedFilterSets","existingIndex","findIndex","set","filterValues","newSet","push","local","savedFilterSets","setSavedFilterSets","select","find","s","Object","entries","confirmation","confirm","currentSelection","sets","option","createElement","appendChild","sectionFilters","sortedItems","_layoutMap$get$order","_layoutMap$get","_layoutMap$get$order2","_layoutMap$get2","orderA","Infinity","orderB","item","_layoutMap$get3","location","defaultLocation","container","createUiComponent","componentName","createFilterElement","renderDateRangeComponent","renderSavedFiltersComponent","className","savedFiltersContainer","elementHtml","label","placeholder","regulationPriorities","prio","coreDescricao","opt","text","applyAutomationFilters","filterSettings","ruleName","dateRange","isNaN","filterId","Renderers","TimelineManager","activeRuleFilters","activeRuleName","isFilteredView","searchKeyword","_this$elements$search","_this$elements$dateIn","_this$elements$dateFi","render","event","header","details","nextElementSibling","toggleDetailsBtn","timelineItem","toggleFilterBtn","toggleFilteredView","clearAutomation","applyDefaultDateRange","timeline","renderTimeline","apiData","fetchAllTimelineData","normalizedData","normalizeTimelineData","_this$elements$dateIn2","_this$elements$dateFi2","_this$elements$search2","startDate","endDate","keyword","normalizeString","length","dataToRender","setHours","searchText","includes","filterTimelineEvents","button","getBaseUrl","baseUrl","Error","handleFetchError","response","status","statusText","getTextFromHTML","htmlString","parser","DOMParser","doc","parseFromString","body","fetchRegulationPriorities","url","URL","fetch","ok","json","p","coreIsAtivo","coreOrdemExibicao","fetchRegulationDetails","reguIdp","reguIds","search","URLSearchParams","method","headers","Accept","contentType","regulacao","parseConsultasHTML","rows","from","getFormattedText","clone","cloneNode","br","parentNode","replaceChild","createTextNode","parseDateForSorting","dateString","datePart","split","startsWith","replace","match","day","month","year","hour","minute","second","i","mainRow","mainCells","dateText","consultation","priority","unit","specialty","professional","isNoShow","endIndex","row","index","blockRows","isSoapNote","some","soapSections","sectionName","headerRowIndex","ciapCid","obsNota","contentEndIndex","sectionRows","diagCell","cell","descDiv","obsCell","finalValue","cidCell","descCell","rowText","nextRow","searchPatients","term","searchString","cns","dataNascimento","cpf","fetchVisualizaUsuario","encodeURIComponent","indexOf","patientData","usuarioServico","fetchProntuarioHash","rawParamString","string","mensagem","fetchConsultasEspecializadas","htmlData","tabela","fetchConsultasBasicas","fetchAllConsultations","basicasResult","especializadasResult","Promise","all","combinedJsonData","combinedHtmlData","fetchExamesSolicitados","exameSolicitadoMin","exameSolicitadoOutro","exameComResultado","exameSemResultado","tipoBusca","_search","nd","page","sidx","sord","examName","hasResult","resultIdp","String","resultIds","fetchResultadoExame","path","fetchCadsusData","formattedCpf","fetchAppointmentDetails","agendamentoConsulta","fetchExamAppointmentDetails","agendamentoExame","fetchAppointments","basicAppointments","time","description","enrichedAppointments","batchSize","batch","promises","appt","specialtyString","apcn","atividadeProfissionalCnes","apcnNome","apcnCod","isSpecialized","agcoIsEspecializada","isOdonto","agcoIsOdonto","settledBatch","fetchRegulations","modalidade","idMatch","descriptionHtml","procedure","cid","requester","provider","fetchAllRegulations","regulationsToFetch","allRegulations","flat","regulationsWithAttachments","regulation","attachmentIsenPk","attachments","fetchRegulationAttachments","dateA","reverse","join","dateB","fetchDocuments","fileType","fetchDocumentUrl","_data$isenArquivo","isenArquivo","img","filePath","isenIdp","isenIds","fetchRegulationAttachmentUrl","_data$regulacaoArquiv","regulacaoArquivo","dataPromises","results","allSettled","dataKeys","keys","getValueOrDefault","reason","timelineData","getNestedValue","obj","reduce","acc","part","formatPhone","digits","formatBoolean","defaultFieldConfig","cadsusKey","enabled","formatter","_data$entidadeFisica","_data$entidadeFisica$","_data$entidadeFisica2","_data$entidadeFisica3","entidadeFisica","entidade","entiTel1Pre","entiTel1","_data$entidadeFisica4","_data$entidadeFisica5","_data$entidadeFisica6","_data$entidadeFisica7","_data$entidadeFisica8","_data$entidadeFisica9","_data$entidadeFisica0","logradouro","tipoLogradouro","tiloNome","logrNome","_data$entidadeFisica1","_data$entidadeFisica10","ctps","entfCTPS","serie","entfCTPSSerie","renderConsultations","contentDiv","c","d","renderExams","exam","idpStr","idsStr","showBtn","renderAppointments","statusStyles","AGENDADO","PRESENTE","FALTOU","CANCELADO","ATENDIDO","typeText","renderRegulations","priorityNameMap","priorityColorMap","coreCor","AUTORIZADO","PENDENTE","NEGADO","DEVOLVIDO","CANCELADA","statusKey","priorityKey","priorityColor","textColor","getContrastYIQ","priorityStyle","priorityText","typeColor","attachmentsHtml","att","renderDocuments","events","eventTypeStyles","color","bgColorClass","iconColorClass","icon","appointment","contentHtml","topRightDetailsHtml","extraInfoHtml","statusClass","timeHtml","statusHtml","detailsButtonHtml","r","title","summary","cadsus","lastCadsusCheck","isUpdating","recentPatients","listeners","listener","splice","_notify","fichaData","cadsusData","clearPatient","setPatientUpdating","setRecentPatients","patients","getRecentPatients","getState","patientDetailsSection","patientMainInfoDiv","patientAdditionalInfoDiv","patientCardFooter","cadsusTimestamp","refreshCadsusBtn","fieldConfigLayout","onForceRefresh","hide","getLocalValue","field","getCadsusValue","sortedFields","localValue","cadsusValue","v1","v2","compareV1","compareV2","tooltipText","valueClass","copyIcon","rowHtml","toLocaleString","disabled","handleToggleDetails","handleForceRefresh","callbacks","searchInput","searchResultsList","recentPatientsList","onSelectPatient","renderSearchResults","renderPatientListItem","renderRecentPatients","recents","_fichaData$isenPK","_fichaData$isenPK2","_patient$isenPK","_patient$isenPK2","nome","isenNumCadSus","handleSearchInput","searchTerm","toggleLoader","handleSearchFocus","handleSearchBlur","setTimeout","handleResultClick","listItem","recentPatient","patientIdp","func","delay","timeoutId","args","clearTimeout","apply","show","loader","messageArea","typeClasses","info","clearMessage","dateMatch","matchedDate","Number","UTC","getUTCFullYear","getUTCMonth","getUTCDate","offsetInMonths","setMonth","getMonth","hexcolor","substr","g","yiq","str","normalize","setupTabs","tabButtons","tabContents","tabName","tab","btn","activeContent","subDetails","eventDate","Boolean","automationFilters","checkText","filterValue","terms","t","normalizedText","consultFilters","cidDetail","cidText","examFilters","apptFilters","apptText","regFilters"],"sourceRoot":""}